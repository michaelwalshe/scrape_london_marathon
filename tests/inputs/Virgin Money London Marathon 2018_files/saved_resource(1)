function inherits(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t}function MarkerLabel_(t,e,i){this.marker_=t,this.handCursorURL_=t.handCursorURL,this.labelDiv_=document.createElement("div"),this.labelDiv_.style.cssText="position: absolute; overflow: hidden;",this.eventDiv_=document.createElement("div"),this.eventDiv_.style.cssText=this.labelDiv_.style.cssText,this.eventDiv_.setAttribute("onselectstart","return false;"),this.eventDiv_.setAttribute("ondragstart","return false;"),this.crossDiv_=MarkerLabel_.getSharedCross(e)}function MarkerWithLabel(t){(t=t||{}).labelContent=t.labelContent||"",t.labelAnchor=t.labelAnchor||new google.maps.Point(0,0),t.labelClass=t.labelClass||"markerLabels",t.labelStyle=t.labelStyle||{},t.labelInBackground=t.labelInBackground||!1,void 0===t.labelVisible&&(t.labelVisible=!0),void 0===t.raiseOnDrag&&(t.raiseOnDrag=!0),void 0===t.clickable&&(t.clickable=!0),void 0===t.draggable&&(t.draggable=!1),void 0===t.optimized&&(t.optimized=!1),t.crossImage=t.crossImage||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png",t.handCursor=t.handCursor||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur",t.optimized=!1,this.label=new MarkerLabel_(this,t.crossImage,t.handCursor),google.maps.Marker.apply(this,arguments)}function MikaResultsBoard(){}function moveAlongPath(t,e,i){if((i=i||0)<t.getPath().getLength()-1){var s=t.getPath().getAt(i),o=t.getPath().getAt(i+1),a=google.maps.geometry.spherical.computeDistanceBetween(s,o);if(e<=a){var r=!1;s.lng()<o.lng()?r="e":s.lng()>o.lng()&&(r="w");var n=google.maps.geometry.spherical.computeOffset(s,e,google.maps.geometry.spherical.computeHeading(s,o));return n.direction=r,n}return moveAlongPath(t,e-a,i+1)}return null}function ClusterIcon(t,e){t.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.cluster_=t,this.className_=t.getMarkerClusterer().getClusterClass(),this.styles_=e,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(t.getMap())}function Cluster(t){this.markerClusterer_=t,this.map_=t.getMap(),this.gridSize_=t.getGridSize(),this.minClusterSize_=t.getMinimumClusterSize(),this.averageCenter_=t.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,t.getStyles())}function MarkerClusterer(t,e,i){this.extend(MarkerClusterer,google.maps.OverlayView),e=e||[],i=i||{},this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.gridSize_=i.gridSize||60,this.minClusterSize_=i.minimumClusterSize||2,this.maxZoom_=i.maxZoom||null,this.styles_=i.styles||[],this.title_=i.title||"",this.zoomOnClick_=!0,void 0!==i.zoomOnClick&&(this.zoomOnClick_=i.zoomOnClick),this.averageCenter_=!1,void 0!==i.averageCenter&&(this.averageCenter_=i.averageCenter),this.ignoreHidden_=!1,void 0!==i.ignoreHidden&&(this.ignoreHidden_=i.ignoreHidden),this.enableRetinaIcons_=!1,void 0!==i.enableRetinaIcons&&(this.enableRetinaIcons_=i.enableRetinaIcons),this.imagePath_=i.imagePath||MarkerClusterer.IMAGE_PATH,this.imageExtension_=i.imageExtension||MarkerClusterer.IMAGE_EXTENSION,this.imageSizes_=i.imageSizes||MarkerClusterer.IMAGE_SIZES,this.calculator_=i.calculator||MarkerClusterer.CALCULATOR,this.batchSize_=i.batchSize||MarkerClusterer.BATCH_SIZE,this.batchSizeIE_=i.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE,this.clusterClass_=i.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(e,!0),this.setMap(t)}function MikaResultsRenderTrigger(){"undefined"!=typeof require&&require(["Mika/Mika"],function(t){(new t).emit("results/board.rendered")})}function MikaSwitchClass(t){t||(t=jQuery("#class-switcher").val());var e=jQuery("body").attr("class").split(/\s+/);jQuery.each(e,function(t,e){"class-switcher-"==e.substr(0,15)&&jQuery("body").removeClass(e)}),document.cookie="results_class_switcher="+t,jQuery("body").addClass("class-switcher-"+t)}function MikaResultsTfd(){}function MikaResultsSearch(){}function setMouse(t){mouseX=t.pointerX(),mouseY=t.pointerY()}function escapeHtml(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML}function lax(vars,ids,options){if(async=0,"object"==typeof ids&&0!=ids.length||(ids={0:"main-content"}),"object"!=typeof options&&(options={}),"object"!=typeof vars&&(vars={}),options.confirm&&!confirm(options.confirm))return!1;var url="?";for(var key in vars)url+="&"+key+"="+vars[key];for(var i in ids){var str="var callback"+i+" = function(result) { this.jq('"+ids[i]+"').update(result); ";options.popup&&(str+="if (this.jq('"+ids[i]+"').style.display == 'none') {",str+="this.jq('"+ids[i]+"').style.display = 'block';",str+="}",str+="this.jq('"+ids[i]+"').style.width = '"+options.popup_width+"px';",str+="this.jq('"+ids[i]+"').style.height = '"+options.popup_height+"px';",str+="this.jq('"+ids[i]+"').style.top = mouseY+'px';",str+="this.jq('"+ids[i]+"').style.top = mouseY+'px';",(options.popup_align="R")?str+="this.jq('"+ids[i]+"').style.left = (mouseX-"+options.popup_width+") +'px';":str+="this.jq('"+ids[i]+"').style.left = mouseX+'px';",str+=""),options.focus&&(str+="document.getElementById('"+options.focus+"').focus();"),str+="};";var str_url=encodeURI(url+"&ajax="+ids[i]);str_url=str_url.replace(/\'/g,"\\'"),str+="HTML_AJAX.grab('"+str_url+"', callback"+i+");",eval(str)}return!0}function pax(t,e,i,s){if("object"!=typeof i&&(i={0:"main-content"}),"object"!=typeof s&&(s={}),"object"!=typeof e&&(e={}),s.confirm&&!confirm(s.confirm))return!1;var o="?";for(var a in e)o+="&"+a+"="+e[a];for(var r in i){var n=encodeURI(o+"&ajax="+i[r]);document.forms[t].action=n,HTML_AJAX.formSubmit(t,i[r])}return!0}function open_popup(t,e){for(query="",i=0;i<t.elements.length;i++)"undefined"!=t.elements[i].name&&"Submit"!=t.elements[i].name&&"namedItem"!=t.elements[i].name&&"item"!=t.elements[i].name&&(query+="&"+t.elements[i].name+"="+t.elements[i].value);win=window.open(t.action+query,e,"width=760,height=600")}function open_print(t,e){e?win=window.open(t,e,"width=900,height=700,scrollbars=yes,resizable=yes,location=no,menubar=no"):window.print()}function ResultsClientTools(){}if(function(t){var e=function(t,e){return t<<e|t>>>32-e},i=function(t,e){var i,s,o,a,r;return o=2147483648&t,a=2147483648&e,i=1073741824&t,s=1073741824&e,r=(1073741823&t)+(1073741823&e),i&s?2147483648^r^o^a:i|s?1073741824&r?3221225472^r^o^a:1073741824^r^o^a:r^o^a},s=function(t,s,o,a,r,n,l){return t=i(t,i(i(function(t,e,i){return t&e|~t&i}(s,o,a),r),l)),i(e(t,n),s)},o=function(t,s,o,a,r,n,l){return t=i(t,i(i(function(t,e,i){return t&i|e&~i}(s,o,a),r),l)),i(e(t,n),s)},a=function(t,s,o,a,r,n,l){return t=i(t,i(i(function(t,e,i){return t^e^i}(s,o,a),r),l)),i(e(t,n),s)},r=function(t,s,o,a,r,n,l){return t=i(t,i(i(function(t,e,i){return e^(t|~i)}(s,o,a),r),l)),i(e(t,n),s)},n=function(t){var e,i="",s="";for(e=0;e<=3;e++)i+=(s="0"+(t>>>8*e&255).toString(16)).substr(s.length-2,2);return i};jQuery.extend({md5:function(t){var e,l,d,h,p,c,u,g,f,m=Array();for(m=function(t){for(var e,i=t.length,s=i+8,o=16*((s-s%64)/64+1),a=Array(o-1),r=0,n=0;n<i;)r=n%4*8,a[e=(n-n%4)/4]=a[e]|t.charCodeAt(n)<<r,n++;return e=(n-n%4)/4,r=n%4*8,a[e]=a[e]|128<<r,a[o-2]=i<<3,a[o-1]=i>>>29,a}(t=function(t){t=t.replace(/\x0d\x0a/g,"\n");for(var e="",i=0;i<t.length;i++){var s=t.charCodeAt(i);s<128?e+=String.fromCharCode(s):s>127&&s<2048?(e+=String.fromCharCode(s>>6|192),e+=String.fromCharCode(63&s|128)):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128),e+=String.fromCharCode(63&s|128))}return e}(t)),c=1732584193,u=4023233417,g=2562383102,f=271733878,e=0;e<m.length;e+=16)l=c,d=u,h=g,p=f,c=s(c,u,g,f,m[e+0],7,3614090360),f=s(f,c,u,g,m[e+1],12,3905402710),g=s(g,f,c,u,m[e+2],17,606105819),u=s(u,g,f,c,m[e+3],22,3250441966),c=s(c,u,g,f,m[e+4],7,4118548399),f=s(f,c,u,g,m[e+5],12,1200080426),g=s(g,f,c,u,m[e+6],17,2821735955),u=s(u,g,f,c,m[e+7],22,4249261313),c=s(c,u,g,f,m[e+8],7,1770035416),f=s(f,c,u,g,m[e+9],12,2336552879),g=s(g,f,c,u,m[e+10],17,4294925233),u=s(u,g,f,c,m[e+11],22,2304563134),c=s(c,u,g,f,m[e+12],7,1804603682),f=s(f,c,u,g,m[e+13],12,4254626195),g=s(g,f,c,u,m[e+14],17,2792965006),u=s(u,g,f,c,m[e+15],22,1236535329),c=o(c,u,g,f,m[e+1],5,4129170786),f=o(f,c,u,g,m[e+6],9,3225465664),g=o(g,f,c,u,m[e+11],14,643717713),u=o(u,g,f,c,m[e+0],20,3921069994),c=o(c,u,g,f,m[e+5],5,3593408605),f=o(f,c,u,g,m[e+10],9,38016083),g=o(g,f,c,u,m[e+15],14,3634488961),u=o(u,g,f,c,m[e+4],20,3889429448),c=o(c,u,g,f,m[e+9],5,568446438),f=o(f,c,u,g,m[e+14],9,3275163606),g=o(g,f,c,u,m[e+3],14,4107603335),u=o(u,g,f,c,m[e+8],20,1163531501),c=o(c,u,g,f,m[e+13],5,2850285829),f=o(f,c,u,g,m[e+2],9,4243563512),g=o(g,f,c,u,m[e+7],14,1735328473),u=o(u,g,f,c,m[e+12],20,2368359562),c=a(c,u,g,f,m[e+5],4,4294588738),f=a(f,c,u,g,m[e+8],11,2272392833),g=a(g,f,c,u,m[e+11],16,1839030562),u=a(u,g,f,c,m[e+14],23,4259657740),c=a(c,u,g,f,m[e+1],4,2763975236),f=a(f,c,u,g,m[e+4],11,1272893353),g=a(g,f,c,u,m[e+7],16,4139469664),u=a(u,g,f,c,m[e+10],23,3200236656),c=a(c,u,g,f,m[e+13],4,681279174),f=a(f,c,u,g,m[e+0],11,3936430074),g=a(g,f,c,u,m[e+3],16,3572445317),u=a(u,g,f,c,m[e+6],23,76029189),c=a(c,u,g,f,m[e+9],4,3654602809),f=a(f,c,u,g,m[e+12],11,3873151461),g=a(g,f,c,u,m[e+15],16,530742520),u=a(u,g,f,c,m[e+2],23,3299628645),c=r(c,u,g,f,m[e+0],6,4096336452),f=r(f,c,u,g,m[e+7],10,1126891415),g=r(g,f,c,u,m[e+14],15,2878612391),u=r(u,g,f,c,m[e+5],21,4237533241),c=r(c,u,g,f,m[e+12],6,1700485571),f=r(f,c,u,g,m[e+3],10,2399980690),g=r(g,f,c,u,m[e+10],15,4293915773),u=r(u,g,f,c,m[e+1],21,2240044497),c=r(c,u,g,f,m[e+8],6,1873313359),f=r(f,c,u,g,m[e+15],10,4264355552),g=r(g,f,c,u,m[e+6],15,2734768916),u=r(u,g,f,c,m[e+13],21,1309151649),c=r(c,u,g,f,m[e+4],6,4149444226),f=r(f,c,u,g,m[e+11],10,3174756917),g=r(g,f,c,u,m[e+2],15,718787259),u=r(u,g,f,c,m[e+9],21,3951481745),c=i(c,l),u=i(u,d),g=i(g,h),f=i(f,p);return(n(c)+n(u)+n(g)+n(f)).toLowerCase()}})}(),function(t){t.topZIndex=function(e){return Math.max(0,Math.max.apply(null,t.map("*"===(e||"*")?t.makeArray(document.getElementsByTagName("*")):t(e),function(e){return parseFloat(t(e).css("z-index"))||null})))},t.fn.topZIndex=function(e){if(0===this.length)return this;e=t.extend({increment:1},e);var i=t.topZIndex(e.selector),s=e.increment;return this.each(function(){this.style.zIndex=i+=s})}}(jQuery),function(t){"use strict";var e=function(e,i){this.$element=t(e),this.isLoading=!1};e.prototype.setState=function(e){var i="disabled",s=this.$element,o=s.data();setTimeout(t.proxy(function(){s.html(null===o[e]?this.options[e]:o[e]),"loading"==e&&(!1===this.isLoading?(0===s.find(".loading-label").length&&(s.data("label-created",!0),s.html('<span class="loading-label">'+s.html()+"</span>")),s.css({width:s.width()+parseInt(s.css("padding-left").replace("px",""))+parseInt(s.css("padding-right").replace("px","")),height:s.height()+parseInt(s.css("padding-top").replace("px",""))+parseInt(s.css("padding-bottom").replace("px",""))}),s.append('<span class="loading-spinner" style="margin-left:-'+s.height()/2+"px;margin-top:-"+(s.height()/2+.08*s.height())+'px"><img src="//static.r.mikatiming.net/stages/blue/images/loading.gif" width="'+s.height()+'" /></span>'),this.isLoading=!0,s.addClass(e).addClass(i).attr(i,i)):(this.isLoading=!1,s.removeClass(e).removeClass(i).removeAttr(i),s.find(".loading-spinner").remove(),!0===s.data("label-created")&&s.html(s.find("loading-label").html())))},this),0)};var i=t.fn.mikaButton;t.fn.mikaButton=function(i){return this.each(function(){var s=t(this),o=s.data("mika.button"),a="object"==typeof i&&i;o||s.data("mika.button",o=new e(this,a)),i&&o.setState(i)})},t.fn.mikaButton.Constructor=e,t.fn.mikaButton.noConflict=function(){return t.fn.mikaButton=i,this}}(jQuery),function(t){if("function"==typeof define&&define.amd)define(t);else if("object"==typeof exports)module.exports=t();else{var e=window.Cookies,i=window.Cookies=t();i.noConflict=function(){return window.Cookies=e,i}}}(function(){function t(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var s in i)e[s]=i[s]}return e}function e(i){function s(e,o,a){var r;if(arguments.length>1){if("number"==typeof(a=t({path:"/"},s.defaults,a)).expires){var n=new Date;n.setMilliseconds(n.getMilliseconds()+864e5*a.expires),a.expires=n}try{r=JSON.stringify(o),/^[\{\[]/.test(r)&&(o=r)}catch(t){}return o=i.write?i.write(o,e):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)),e=e.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),e=e.replace(/[\(\)]/g,escape),document.cookie=[e,"=",o,a.expires&&"; expires="+a.expires.toUTCString(),a.path&&"; path="+a.path,a.domain&&"; domain="+a.domain,a.secure?"; secure":""].join("")}e||(r={});for(var l=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,h=0;h<l.length;h++){var p=l[h].split("="),c=p[0].replace(d,decodeURIComponent),u=p.slice(1).join("=");'"'===u.charAt(0)&&(u=u.slice(1,-1));try{if(u=i.read?i.read(u,c):i(u,c)||u.replace(d,decodeURIComponent),this.json)try{u=JSON.parse(u)}catch(t){}if(e===c){r=u;break}e||(r[c]=u)}catch(t){}}return r}return s.get=s.set=s,s.getJSON=function(){return s.apply({json:!0},[].slice.call(arguments))},s.defaults={},s.remove=function(e,i){s(e,"",t(i,{expires:-1}))},s.withConverter=e,s}return e(function(){})}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(){var e,i,s,o=this._type,a=arguments.length,r=window[o],n=arguments,l=n[0];if(a<1)throw new Error("Minimum 1 argument must be given");if(t.isArray(l)){i={};for(var d in l){e=l[d];try{i[e]=JSON.parse(r.getItem(e))}catch(t){i[e]=r.getItem(e)}}return i}if(1!=a){try{i=JSON.parse(r.getItem(l))}catch(t){throw new ReferenceError(l+" is not defined in this storage")}for(d=1;d<a-1;d++)if(void 0===(i=i[n[d]]))throw new ReferenceError([].slice.call(n,1,d+1).join(".")+" is not defined in this storage");if(t.isArray(n[d])){s=i,i={};for(var h in n[d])i[n[d][h]]=s[n[d][h]];return i}return i[n[d]]}try{return JSON.parse(r.getItem(l))}catch(t){return r.getItem(l)}}function i(){var e,i,s,o=this._type,a=arguments.length,r=window[o],n=arguments,l=n[0],d=n[1],h=isNaN(d)?{}:[];if(a<1||!t.isPlainObject(l)&&a<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(t.isPlainObject(l)){for(var p in l)e=l[p],t.isPlainObject(e)||this.alwaysUseJson?r.setItem(p,JSON.stringify(e)):r.setItem(p,e);return l}if(2==a)return"object"==typeof d||this.alwaysUseJson?r.setItem(l,JSON.stringify(d)):r.setItem(l,d),d;try{null!=(s=r.getItem(l))&&(h=JSON.parse(s))}catch(t){}s=h;for(p=1;p<a-2;p++)e=n[p],i=isNaN(n[p+1])?"object":"array",(!s[e]||"object"==i&&!t.isPlainObject(s[e])||"array"==i&&!t.isArray(s[e]))&&(s[e]="array"==i?[]:{}),s=s[e];return s[n[p]]=n[p+1],r.setItem(l,JSON.stringify(h)),h}function s(){var e,i,s=this._type,o=arguments.length,a=window[s],r=arguments,n=r[0];if(o<1)throw new Error("Minimum 1 argument must be given");if(t.isArray(n)){for(var l in n)a.removeItem(n[l]);return!0}if(1==o)return a.removeItem(n),!0;try{e=i=JSON.parse(a.getItem(n))}catch(t){throw new ReferenceError(n+" is not defined in this storage")}for(l=1;l<o-1;l++)if(void 0===(i=i[r[l]]))throw new ReferenceError([].slice.call(r,1,l).join(".")+" is not defined in this storage");if(t.isArray(r[l]))for(var d in r[l])delete i[r[l][d]];else delete i[r[l]];return a.setItem(n,JSON.stringify(e)),!0}function o(e){var i=n.call(this);for(var o in i)s.call(this,i[o]);if(e)for(var o in t.namespaceStorages)l(o)}function a(){var i=arguments.length,s=arguments,o=s[0];if(0==i)return 0==n.call(this).length;if(t.isArray(o)){for(var r=0;r<o.length;r++)if(!a.call(this,o[r]))return!1;return!0}try{var l=e.apply(this,arguments);t.isArray(s[i-1])||(l={totest:l});for(var r in l)if(!(t.isPlainObject(l[r])&&t.isEmptyObject(l[r])||t.isArray(l[r])&&!l[r].length)&&l[r])return!1;return!0}catch(t){return!0}}function r(){var i=arguments.length,s=arguments,o=s[0];if(i<1)throw new Error("Minimum 1 argument must be given");if(t.isArray(o)){for(var a=0;a<o.length;a++)if(!r.call(this,o[a]))return!1;return!0}try{var n=e.apply(this,arguments);t.isArray(s[i-1])||(n={totest:n});for(var a in n)if(void 0===n[a]||null===n[a])return!1;return!0}catch(t){return!1}}function n(){var t=this._type,i=arguments.length,s=window[t],o=[],a={};if((a=i>0?e.apply(this,arguments):s)&&a._cookie)for(var r in Cookies.get())""!=r&&o.push(r.replace(a._prefix,""));else for(var n in a)a.hasOwnProperty(n)&&o.push(n);return o}function l(e){if(!e||"string"!=typeof e)throw new Error("First parameter must be a string");d?(window.localStorage.getItem(e)||window.localStorage.setItem(e,"{}"),window.sessionStorage.getItem(e)||window.sessionStorage.setItem(e,"{}")):(window.localCookieStorage.getItem(e)||window.localCookieStorage.setItem(e,"{}"),window.sessionCookieStorage.getItem(e)||window.sessionCookieStorage.setItem(e,"{}"));var i={localStorage:t.extend({},t.localStorage,{_ns:e}),sessionStorage:t.extend({},t.sessionStorage,{_ns:e})};return"undefined"!=typeof Cookies&&(window.cookieStorage.getItem(e)||window.cookieStorage.setItem(e,"{}"),i.cookieStorage=t.extend({},t.cookieStorage,{_ns:e})),t.namespaceStorages[e]=i,i}var d=function(t){try{return!!window[t]&&(window[t].setItem("jsapi","jsapi"),window[t].removeItem("jsapi"),!0)}catch(t){return!1}}("localStorage"),h={_type:"",_ns:"",_callMethod:function(t,e){var i=[],s=(e=Array.prototype.slice.call(e))[0];return this._ns&&i.push(this._ns),"string"==typeof s&&-1!==s.indexOf(".")&&(e.shift(),[].unshift.apply(e,s.split("."))),[].push.apply(i,e),t.apply(this,i)},alwaysUseJson:!1,get:function(){return this._callMethod(e,arguments)},set:function(){var e=arguments.length,s=arguments,o=s[0];if(e<1||!t.isPlainObject(o)&&e<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(t.isPlainObject(o)&&this._ns){for(var a in o)this._callMethod(i,[a,o[a]]);return o}var r=this._callMethod(i,s);return this._ns?r[o.split(".")[0]]:r},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},removeAll:function(t){return this._ns?(this._callMethod(i,[{}]),!0):this._callMethod(o,[t])},isEmpty:function(){return this._callMethod(a,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(r,arguments)},keys:function(){return this._callMethod(n,arguments)}};if("undefined"!=typeof Cookies){window.name||(window.name=Math.floor(1e8*Math.random()));var p={_cookie:!0,_prefix:"",_expires:null,_path:null,_domain:null,setItem:function(t,e){Cookies.set(this._prefix+t,e,{expires:this._expires,path:this._path,domain:this._domain})},getItem:function(t){return Cookies.get(this._prefix+t)},removeItem:function(t){return Cookies.remove(this._prefix+t,{path:this._path})},clear:function(){for(var t in Cookies.get())""!=t&&(!this._prefix&&-1===t.indexOf("ls_")&&-1===t.indexOf("ss_")||this._prefix&&0===t.indexOf(this._prefix))&&Cookies.remove(t)},setExpires:function(t){return this._expires=t,this},setPath:function(t){return this._path=t,this},setDomain:function(t){return this._domain=t,this},setConf:function(t){return t.path&&(this._path=t.path),t.domain&&(this._domain=t.domain),t.expires&&(this._expires=t.expires),this},setDefaultConf:function(){this._path=this._domain=this._expires=null}};d||(window.localCookieStorage=t.extend({},p,{_prefix:"ls_",_expires:3650}),window.sessionCookieStorage=t.extend({},p,{_prefix:"ss_"+window.name+"_"})),window.cookieStorage=t.extend({},p),t.cookieStorage=t.extend({},h,{_type:"cookieStorage",setExpires:function(t){return window.cookieStorage.setExpires(t),this},setPath:function(t){return window.cookieStorage.setPath(t),this},setDomain:function(t){return window.cookieStorage.setDomain(t),this},setConf:function(t){return window.cookieStorage.setConf(t),this},setDefaultConf:function(){return window.cookieStorage.setDefaultConf(),this}})}t.initNamespaceStorage=function(t){return l(t)},d?(t.localStorage=t.extend({},h,{_type:"localStorage"}),t.sessionStorage=t.extend({},h,{_type:"sessionStorage"})):(t.localStorage=t.extend({},h,{_type:"localCookieStorage"}),t.sessionStorage=t.extend({},h,{_type:"sessionCookieStorage"})),t.namespaceStorages={},t.removeAllStorages=function(e){t.localStorage.removeAll(e),t.sessionStorage.removeAll(e),t.cookieStorage&&t.cookieStorage.removeAll(e),e||(t.namespaceStorages={})},t.alwaysUseJsonInStorage=function(e){h.alwaysUseJson=e,t.localStorage.alwaysUseJson=e,t.sessionStorage.alwaysUseJson=e,t.cookieStorage&&(t.cookieStorage.alwaysUseJson=e)}}),"object"==typeof google&&(inherits(MarkerLabel_,google.maps.OverlayView),MarkerLabel_.getSharedCross=function(t){var e;return void 0===MarkerLabel_.getSharedCross.crossDiv&&((e=document.createElement("img")).style.cssText="position: absolute; z-index: 1000002; display: none;",e.style.marginLeft="-8px",e.style.marginTop="-9px",e.src=t,MarkerLabel_.getSharedCross.crossDiv=e),MarkerLabel_.getSharedCross.crossDiv},MarkerLabel_.prototype.onAdd=function(){var t,e,i,s,o,a,r,n=this,l=!1,d=!1,h="url("+this.handCursorURL_+")",p=function(t){t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},c=function(){n.marker_.setAnimation(null)};this.getPanes().markerLayer.appendChild(this.labelDiv_),this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_),void 0===MarkerLabel_.getSharedCross.processed&&(this.getPanes().overlayImage.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=!0),this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(this.style.cursor="pointer",google.maps.event.trigger(n.marker_,"mouseover",t))}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(t){!n.marker_.getDraggable()&&!n.marker_.getClickable()||d||(this.style.cursor=n.marker_.getCursor(),google.maps.event.trigger(n.marker_,"mouseout",t))}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(t){d=!1,n.marker_.getDraggable()&&(l=!0,this.style.cursor=h),(n.marker_.getDraggable()||n.marker_.getClickable())&&(google.maps.event.trigger(n.marker_,"mousedown",t),p(t))}),google.maps.event.addDomListener(document,"mouseup",function(e){var i;if(l&&(l=!1,n.eventDiv_.style.cursor="pointer",google.maps.event.trigger(n.marker_,"mouseup",e)),d){if(o){(i=n.getProjection().fromLatLngToDivPixel(n.marker_.getPosition())).y+=20,n.marker_.setPosition(n.getProjection().fromDivPixelToLatLng(i));try{n.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(c,1406)}catch(t){}}n.crossDiv_.style.display="none",n.marker_.setZIndex(t),s=!0,d=!1,e.latLng=n.marker_.getPosition(),google.maps.event.trigger(n.marker_,"dragend",e)}}),google.maps.event.addListener(n.marker_.getMap(),"mousemove",function(s){var h;l&&(d?(s.latLng=new google.maps.LatLng(s.latLng.lat()-e,s.latLng.lng()-i),h=n.getProjection().fromLatLngToDivPixel(s.latLng),o&&(n.crossDiv_.style.left=h.x+"px",n.crossDiv_.style.top=h.y+"px",n.crossDiv_.style.display="",h.y-=20),n.marker_.setPosition(n.getProjection().fromDivPixelToLatLng(h)),o&&(n.eventDiv_.style.top=h.y+20+"px"),google.maps.event.trigger(n.marker_,"drag",s)):(e=s.latLng.lat()-n.marker_.getPosition().lat(),i=s.latLng.lng()-n.marker_.getPosition().lng(),t=n.marker_.getZIndex(),a=n.marker_.getPosition(),r=n.marker_.getMap().getCenter(),o=n.marker_.get("raiseOnDrag"),d=!0,n.marker_.setZIndex(1e6),s.latLng=n.marker_.getPosition(),google.maps.event.trigger(n.marker_,"dragstart",s)))}),google.maps.event.addDomListener(document,"keydown",function(t){d&&27===t.keyCode&&(o=!1,n.marker_.setPosition(a),n.marker_.getMap().setCenter(r),google.maps.event.trigger(document,"mouseup",t))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(s?s=!1:(google.maps.event.trigger(n.marker_,"click",t),p(t)))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(google.maps.event.trigger(n.marker_,"dblclick",t),p(t))}),google.maps.event.addListener(this.marker_,"dragstart",function(t){d||(o=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(t){d||o&&(n.setPosition(20),n.labelDiv_.style.zIndex=1e6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(t){d||o&&n.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){n.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){n.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){n.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){n.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){n.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){n.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){n.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){n.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){n.setStyles()})]},MarkerLabel_.prototype.onRemove=function(){var t;for(this.labelDiv_.parentNode.removeChild(this.labelDiv_),this.eventDiv_.parentNode.removeChild(this.eventDiv_),t=0;t<this.listeners_.length;t++)google.maps.event.removeListener(this.listeners_[t])},MarkerLabel_.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},MarkerLabel_.prototype.setContent=function(){var t=this.marker_.get("labelContent");void 0===t.nodeType?(this.labelDiv_.innerHTML=t,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(t),t=t.cloneNode(!0),this.eventDiv_.innerHTML="",this.eventDiv_.appendChild(t))},MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""},MarkerLabel_.prototype.setStyles=function(){var t,e;this.labelDiv_.className=this.marker_.get("labelClass"),this.eventDiv_.className=this.labelDiv_.className,this.labelDiv_.style.cssText="",this.eventDiv_.style.cssText="",e=this.marker_.get("labelStyle");for(t in e)e.hasOwnProperty(t)&&(this.labelDiv_.style[t]=e[t],this.eventDiv_.style[t]=e[t]);this.setMandatoryStyles()},MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute",this.labelDiv_.style.overflow="hidden",void 0!==this.labelDiv_.style.opacity&&""!==this.labelDiv_.style.opacity&&(this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+100*this.labelDiv_.style.opacity+')"',this.labelDiv_.style.filter="alpha(opacity="+100*this.labelDiv_.style.opacity+")"),this.eventDiv_.style.position=this.labelDiv_.style.position,this.eventDiv_.style.overflow=this.labelDiv_.style.overflow,this.eventDiv_.style.opacity=.01,this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"',this.eventDiv_.style.filter="alpha(opacity=1)",this.setAnchor(),this.setPosition(),this.setVisible()},MarkerLabel_.prototype.setAnchor=function(){var t=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-t.x+"px",this.labelDiv_.style.marginTop=-t.y+"px",this.eventDiv_.style.marginLeft=-t.x+"px",this.eventDiv_.style.marginTop=-t.y+"px"},MarkerLabel_.prototype.setPosition=function(t){var e=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());void 0===t&&(t=0),this.labelDiv_.style.left=Math.round(e.x)+"px",this.labelDiv_.style.top=Math.round(e.y-t)+"px",this.eventDiv_.style.left=this.labelDiv_.style.left,this.eventDiv_.style.top=this.labelDiv_.style.top,this.setZIndex()},MarkerLabel_.prototype.setZIndex=function(){var t=this.marker_.get("labelInBackground")?-1:1;void 0===this.marker_.getZIndex()?(this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+t,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex):(this.labelDiv_.style.zIndex=this.marker_.getZIndex()+t,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex)},MarkerLabel_.prototype.setVisible=function(){this.marker_.get("labelVisible")?this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none":this.labelDiv_.style.display="none",this.eventDiv_.style.display=this.labelDiv_.style.display},inherits(MarkerWithLabel,google.maps.Marker),MarkerWithLabel.prototype.setMap=function(t){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(t)}),MikaResultsBoard.prototype={options:{},requester:{},data:{},targetElement:{},strings:{},timer:{},options_submit:{},subSelectorState:{},favorites:[],renderQueue:[],maps:{},mapPolylines:{},mapMarkers:{},mapMarkersPersons:{},mapMarkersFree:{},mapMarkerCluster:{},mapMarkerClusterIcons:{},mapOverlays:{},mapAutoZoom:!1,mapBounds:{},favoritesSelected:[],replay_time_max:0,replay_time:0,replay_daytime:0,replay_speed:0,replay_running:!1,slider_time:{},slider_speed:{},events:{},eventsDelete:{},favoritesOrderReplay:{},favoritesOrderLive:{},shift_pressed:!1,ctrl_pressed:!1,shortcuts_registred:!1,debugTimers:{},pixelRatio:1,setOptions:function(t){this.options=t},setJQ:function(t){},createResultsBoard:function(t){"function"==typeof jQuery?(this.targetElement=t,this.options.autoFollow=!0,this.favorites=[],this.events.click=[],this.events.mouseover=[],this.events.mouseout=[],this.eventsDelete.click=[],this.eventsDelete.mouseover=[],this.eventsDelete.mouseout=[],this.options_submit.option_bar={},this.mapOverlays=[],this.pixelRatio=this.getDevicePixelRatio(),this.load()):console.log("no jQuery found!")},makeRequest:function(t,e,i){this.requester[t]=jQuery.ajax({type:"POST",url:this.options.path+"/index.php?content=ajax2&func="+t+"&onpage="+this.options.pid,data:{func:t,options:e},success:i})},log:function(t,e,i){var s;this.options.debug&&"object"==typeof console&&(i?this.debugTimers[t]=this.microtime():this.debugTimers[t]&&(s=t+" (duration "+(this.microtime()-this.debugTimers[t])+"ms)"),e||(e="log"),console[e](s||t))},ms2time:function(t){var e,i,s,o,a;return t<0?(t*=-1,e="-"):e="",a=Math.ceil(t/1e3),o=a/60,s=o/60,i=s/24,o>=1?a-=60*(o=Math.floor(o)):o=0,s>=1?o-=60*(s=Math.floor(s)):s=0,i>=1?s-=24*(i=Math.floor(i)):i=0,s<10&&(s="0"+s),o<10&&(o="0"+o),a<10&&(a="0"+a),i?e+i+s+":"+o+":"+a:e+s+":"+o+":"+a},load:function(){this.log("load...","info"),this.log(this.options_submit,"debug"),this.options_submit.lang=this.options.lang,this.options_submit.pid=this.options.pid,this.options_submit.client_seconds=this.getClientSeconds(),this.options.event_default&&!this.options_submit.option_bar.event&&(this.options_submit.option_bar.event=this.options.event_default),this.options.addFavorite&&-1==this.favorites.indexOf(this.options.addFavorite)&&(this.favorites.push(this.options.addFavorite),this.options_submit.command={name:"addFavorite",id:this.options.addFavorite});var t=this.options.globalObjectName;this.makeRequest("getLeaderboard",this.options_submit,function(e){window[t].setData(e)})},addToRenderQueue:function(t){-1==this.renderQueue.indexOf(t)&&this.renderQueue.push(t)},clearRenderQueue:function(){this.renderQueue=[]},registerEvents:function(){var t;for(var e in this.eventsDelete)if(this.eventsDelete.hasOwnProperty(e))for(t in this.eventsDelete[e])this.eventsDelete[e].hasOwnProperty(t)&&jQuery(this.eventsDelete[e][t].selector).off(e);for(var e in this.events)if(this.events.hasOwnProperty(e)){if("click"==e)for(t in this.events[e])this.events[e].hasOwnProperty(t)&&(void 0!==this.events[e][t].data?jQuery(this.events[e][t].selector).click(this.events[e][t].data,this.events[e][t].func):jQuery(this.events[e][t].selector).click(this.events[e][t].func));if("mouseover"==e)for(t in this.events[e])this.events[e].hasOwnProperty(t)&&jQuery(this.events[e][t].selector).mouseover(this.events[e][t].func);if("mouseout"==e)for(t in this.events[e])this.events[e].hasOwnProperty(t)&&jQuery(this.events[e][t].selector).mouseout(this.events[e][t].func)}if(this.events.click=[],this.events.mouseover=[],this.events.mouseout=[],this.eventsDelete.click=[],this.eventsDelete.mouseover=[],this.eventsDelete.mouseout=[],this.data.global.options.shortcuts&&!this.shortcuts_registred){var i=this.options.globalObjectName;jQuery(document).keyup(function(t){16===t.keyCode&&(window[i].shift_pressed=!1),17===t.keyCode&&(window[i].ctrl_pressed=!1)}),jQuery(document).keydown(function(t){16===t.keyCode&&(window[i].shift_pressed=!0),17===t.keyCode&&(window[i].ctrl_pressed=!0),72===t.keyCode&&(window[i].shift_pressed?window[i].trigger("switchControlsExtended",{}):window[i].trigger("switchControls",{})),"88"===t.keyCode&&window[i].trigger("switchFullscreen")}),this.shortcuts_registred=!0}},setData:function(t){this.log("function: setData","info");var e,i=!1;void 0===this.data.settings&&(i=!0);var s=!1;if("object"==typeof this.data.settings&&this.data.settings.global_event&&this.data.settings.global_event!=t.settings.global_event&&(s=!0),this.data.settings=t.settings,this.data.lastUpdateTs=t.lastUpdateTs,void 0!==t.settings&&void 0!==t.settings.time_offset&&"function"==typeof require&&require(["Mika/Timer"],function(t){}),this.options_submit.command={},t.settings.favorites){this.favorites=[];for(e in t.settings.favorites)t.settings.favorites.hasOwnProperty(e)&&this.favorites.push(t.settings.favorites[e])}void 0===this.data.global&&(this.data.global={},this.data.global.meta={},this.options_submit.globalData={});for(e in t.globalData)t.globalData.hasOwnProperty(e)&&("ok"==t.globalData[e].state?(this.data.global[e]=t.globalData[e].data,this.data.global.meta[e]={},this.data.global.meta[e].state=t.globalData[e].state,this.data.global.meta[e].hash=t.globalData[e].hash):"nothing_changed"==t.globalData[e].state&&(this.data.global.meta[e].state="nothing_changed"),this.options_submit.globalData[e]={},this.options_submit.globalData[e].hash=t.globalData[e].hash);for(e in this.data.global)this.data.global.hasOwnProperty(e)&&"meta"!=e&&void 0===t.globalData[e]&&delete this.data.global[e];if(i||"object"!=typeof this.data.containers)this.data.containers=t.containers;else{for(e in t.containers)if(t.containers.hasOwnProperty(e))if("ok"==t.containers[e].state){if(this.data.containers[e]=t.containers[e],!s)switch(t.containers[e].type){case"favorites":this.addToRenderQueue("favorites"),this.addToRenderQueue("list");break;case"list":this.addToRenderQueue("list");break;case"map":this.addToRenderQueue("map");break;case"overlays":this.addToRenderQueue("overlays")}}else"nothing_changed"==t.containers[e].state&&(this.data.containers[e].state="nothing_changed");for(e in this.data.containers)this.data.containers.hasOwnProperty(e)&&void 0===t.containers[e]&&delete this.data.containers[e];s||this.renderFromQueue()}this.options_submit.containers={};for(e in this.data.containers)this.data.containers.hasOwnProperty(e)&&(this.options_submit.containers[e]={},this.options_submit.containers[e].hash=this.data.containers[e].hash);this.strings=this.data.global.strings,jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-containers").length?(s&&(this.clearCols(),this.renderContainers()),"nothing_changed"!=this.data.global.meta.global_option_bar.state&&this.renderOptionBar(!0)):this.render(),this.refresh(),this.data.global.options.replay_mode&&this.mapInitSliders(),this.data.global.options.refresh&&(window.clearTimeout(this.timer.load),this.timer.load=window.setTimeout(this.options.globalObjectName+".load()",1e3*this.data.global.options.refresh)),"jqm"==this.options.theme&&(jQuery(".lb-containers").trigger("create"),applySizes()),i||void 0!==this.data.global.global_option_bar.options.show_last_update&&!0===this.data.global.global_option_bar.options.show_last_update&&(void 0!==this.data.global.global_option_bar.options.last_update_count_up&&!0===this.data.global.global_option_bar.options.last_update_count_up?jQuery(".resultsboard-"+this.options.globalObjectName+' [data-type="lastupdatetimestamp"]').html('<time datetime="'+this.data.lastUpdateTs+'" data-direction="up">00:00</time>'):jQuery(".resultsboard-"+this.options.globalObjectName+' [data-type="lastupdatetimestamp"]').html(this.formatTime(new Date))),MikaResultsRenderTrigger()},formatTime:function(t){var e=t.getHours(),i=t.getMinutes(),s=t.getSeconds();return i<10&&(i="0"+i),s<10&&(s="0"+s),e+":"+i+":"+s},microtime:function(){return(new Date).getTime()},getClientSeconds:function(){var t=new Date,e=3600*t.getHours();return e+=60*t.getMinutes(),e+=t.getSeconds()},refresh:function(){this.log("function: refresh","info",!0),this.refresh_counter||(this.refresh_counter=0),this.refresh_counter++;var t,e,i,s,o,a,r=0,n=0,l=0,d=this.getContainerByType("favorites");if(d.data){var h={},p={},c={},u={},g=0,f=0;for(var m in d.data.rows)if(d.data.rows.hasOwnProperty(m)){var _=d.data.rows[m];_.split_groups[_.global_info.active_group_key];void 0===_.is_in_replay&&("F"==_.global_info.race_status&&this.data.global.options.replay_mode?_.is_in_replay=!0:_.is_in_replay=!1),e=!1,i=!1,k=!1,_.starttime_net_ms&&(_.starttime_net_ms=parseInt(_.starttime_net_ms),g||(g=_.starttime_net_ms),g=Math.min(g,_.starttime_net_ms));for(t in _.splits)_.splits.hasOwnProperty(t)&&(s=_.splits[t],_.is_in_replay?(f=this.data.global.options.replay_daytime?_.starttime_net_ms-g:0,this.replay_time&&s.time_ms&&s.time_ms+f<=this.replay_time&&(e=s,void 0!==_.splits[parseInt(t)+1]?i=_.splits[parseInt(t)+1]:(i=e,k=!0)),s.time_ms&&(this.data.global.options.replay_daytime?this.replay_time_max=Math.max(this.replay_time_max,s.time_ms+f):this.replay_time_max=Math.max(this.replay_time_max,s.time_ms))):s.time_ms&&"-"!=s.time_ms&&(e=s,i=!1));if(!e&&_.is_in_replay){for(t in _.splits)if(_.splits.hasOwnProperty(t)){i=_.splits[t];break}e=i}if(i){for(o in _.split_groups)if(_.split_groups.hasOwnProperty(o))if(o==e.group)if(void 0===p[o]&&(p[o]={}),void 0===h[o]&&(h[o]={}),_.is_in_replay&&this.data.global.options.replay_mode){_.split_groups[o].active=!0,_.global_info.active_group_key=o,n=0,this.data.global.options.replay_daytime?(l=(this.replay_time-f-e.time_ms)/i.ms_km_estimate,l+=e.km-_.split_groups[o].first_km):(l=(this.replay_time-e.time_ms)/i.ms_km_estimate,l+=e.km-_.split_groups[o].first_km),(isNaN(l)||l<0)&&(l=0),_.split_groups[o].estimated_pos=l;var v=this.replay_time-f;_.race_time=v>0&&!k?this.ms2time(v):k?e.time:"00:00:00",_.split_groups[o].estimated_pos_string=l.toFixed(2),p[o][_.id]=l,_.split_groups[o].state="started",k&&(_.split_groups[o].estimated_pos="finished",_.split_groups[o].state="finished")}else isNaN(_.split_groups[o].estimated_pos)?h[o][_.id]=0:h[o][_.id]=_.split_groups[o].estimated_pos;else _.is_in_replay&&this.data.global.options.replay_mode&&(_.split_groups[o].active=!1)}else{if(!e)for(o in _.split_groups)if(_.split_groups.hasOwnProperty(o)){"S"==_.global_info.race_status?(_.split_groups[o].estimated_pos="not_started",_.split_groups[o].estimated_pos_string="not_started"):(_.split_groups[o].estimated_pos="started",_.split_groups[o].estimated_pos_string="started");break}var y=(1e3*(this.getClientSeconds()+this.data.settings.time_offset)-_.position_data.daytime_last_change)/1e3*(_.position_data.speed_kmh/3.6),b=((1e3*_.position_data.pos_km+y)/1e3).toFixed(2);b<_.position_data.pos_km&&(b=_.position_data.pos_km.toFixed(2));for(o in _.split_groups)_.split_groups.hasOwnProperty(o)&&(o!=e.group&&"estimated_chip"==_.position_data.source||("A"==_.global_info.race_status?(_.split_groups[o].state="started",b<=_.position_data.valid_until_km?_.split_groups[o].estimated_pos=_.split_groups[o].estimated_pos_string=b:_.split_groups[o].estimated_pos=_.split_groups[o].estimated_pos_string=_.position_data.valid_until_km):"F"==_.global_info.race_status?_.split_groups[o].estimated_pos=_.split_groups[o].state="finished":"S"==_.global_info.race_status&&(_.split_groups[o].estimated_pos=_.split_groups[o].state="not_started"),void 0===p[o]&&(p[o]={}),void 0===h[o]&&(h[o]={}),isNaN(_.split_groups[o].estimated_pos)?h[o][_.id]=0:h[o][_.id]=_.split_groups[o].estimated_pos))}}for(m in d.data.rows)if(d.data.rows.hasOwnProperty(m)){_=d.data.rows[m],e="",i="";var k=!1;for(t in _.splits)_.splits.hasOwnProperty(t)&&(s=_.splits[t],_.is_in_replay?this.replay_time&&s.time_ms<=this.replay_time&&(e=s,void 0!==_.splits[parseInt(t)+1]?i=_.splits[parseInt(t)+1]:(i=e,k=!0)):s.time_ms&&"-"!=s.time_ms&&(e=s,i=!1));e||(e=i=_.splits[0]),c[e.group]=0,u[e.group]=0;for(t in h[e.group])h[e.group].hasOwnProperty(t)&&(c[e.group]=Math.max(h[e.group][t],c[e.group]));for(t in p[e.group])p[e.group].hasOwnProperty(t)&&(u[e.group]=Math.max(p[e.group][t],u[e.group]));for(o in _.split_groups)_.split_groups.hasOwnProperty(o)&&o==e.group&&(_.is_in_replay&&this.data.global.options.replay_mode?(r=u[o]-_.split_groups[o].estimated_pos,_.split_groups[o].diff_km=r,isNaN(r)&&0!=r?_.split_groups[o].diff_km_string="+0 km":_.split_groups[o].diff_km_string="+"+r.toFixed(2)+" km",n=(u[o]-_.split_groups[o].estimated_pos)*i.ms_km_estimate,_.split_groups[o].diff_time=n,isNaN(n)&&0!=n?_.split_groups[o].diff_time_string="+0":_.split_groups[o].diff_time_string="+"+this.ms2time(n)):(r=c[o]-_.split_groups[o].estimated_pos,_.split_groups[o].diff_km=r,isNaN(r)&&0!=r?_.split_groups[o].diff_km_string="+0 km":_.split_groups[o].diff_km_string="+"+r.toFixed(2)+" km",n=(c[o]-_.split_groups[o].estimated_pos)*_.split_groups[o].ms_km_estimate,_.split_groups[o].diff_time=n,isNaN(n)&&0!=n?_.split_groups[o].diff_time_string="+0":_.split_groups[o].diff_time_string="+"+this.ms2time(n)))}this.favoritesOrderLive={};for(o in h)if(h.hasOwnProperty(o)){a={};for(t in h[o])h[o].hasOwnProperty(t)&&(a[h[o][t]]=t);a=this.sortObjByKey(a,!0),this.favoritesOrderLive[o]=[];for(t in a)a.hasOwnProperty(t)&&this.favoritesOrderLive[o].push(a[t]);this.favoritesOrderLive[o].reverse();for(t in h[o])h[o].hasOwnProperty(t)&&(h[o][t]||this.favoritesOrderLive[o].push(t))}this.favoritesOrderReplay={};for(o in p)if(p.hasOwnProperty(o)){a={};for(t in p[o])p[o].hasOwnProperty(t)&&p[o][t]&&(a[p[o][t]]=t);a=this.sortObjByKey(a,!0),this.favoritesOrderReplay[o]=[];for(t in a)a.hasOwnProperty(t)&&this.favoritesOrderReplay[o].push(a[t]);this.favoritesOrderReplay[o].reverse();for(t in p[o])p[o].hasOwnProperty(t)&&(p[o][t]||this.favoritesOrderReplay[o].push(t))}this.log("function: refresh","info");for(t in this.data.containers)this.data.containers.hasOwnProperty(t)&&"map"==this.data.containers[t].type&&this.mapUpdate(t);for(t in this.data.containers)this.data.containers.hasOwnProperty(t)&&"favorites"==this.data.containers[t].type&&this.updateContainerContentTypeFavorites(t,!0);!this.replay_running&&this.data.global.options.refresh_update_ms&&(window.clearTimeout(this.timer.refresh),this.timer.refresh=window.setTimeout(this.options.globalObjectName+".refresh()",this.data.global.options.refresh_update_ms)),this.data.global.options.replay_daytime?jQuery("#replay-racetime").html(this.ms2time(this.replay_time+g)):jQuery("#replay-racetime").html(this.ms2time(this.replay_time)),this.log("function: refresh","info")}},sortObjByKey:function(t,e){var i,s=[],o={};for(i in t)t.hasOwnProperty(i)&&s.push(i);e?s.sort(function(t,e){return t-e}):s.sort();for(i in s)s.hasOwnProperty(i)&&(o[s[i]]=t[s[i]]);return o},replayStep:function(){var t=this.data.global.options.replay_step*this.replay_speed;this.replay_time<=this.replay_time_max?(this.replay_time+=t,this.slider_time.slider("value",this.replay_time),jQuery(".resultsboard-"+this.options.globalObjectName+" .replay-racetime").html(window[this.options.globalObjectName].ms2time(this.replay_time)),this.refresh()):this.replayStop()},replayStart:function(){this.replay_time>=this.replay_time_max&&(this.replay_time=0),this.replay_running=!0,jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-containers").addClass("replay-running"),window.clearInterval(this.timer.refresh),window.clearInterval(this.timer.replay),this.timer.replay=window.setInterval("window['"+this.options.globalObjectName+"'].replayStep()",this.data.global.options.replay_step)},replayStop:function(){this.replay_running=!1,jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-containers").removeClass("replay-running"),window.clearInterval(this.timer.replay),this.refresh()},replayRewind:function(){this.replay_time=0,this.replayStop(),this.replayStart()},renderMainButtons:function(){var t="";return"fixed"!=jQuery(".cbox.left .list").css("position")?t+='  <div title="'+this.strings.help_fullscreen+'" class="tt-help layout-button layout-button-fullscreen"><img onclick="'+this.options.globalObjectName+".trigger('switchFullscreen');\" src=\""+this.options.path_images+'/icon_fullscreen.png" alt="'+this.strings.reload+'"/><span onclick="'+this.options.globalObjectName+".trigger('switchFullscreen');\">"+this.strings.fullscreen+"</span></div>":t+='  <div class="tt-help layout-button layout-button-fullscreen"><img onclick="'+this.options.globalObjectName+".trigger('switchFullscreen');\" src=\""+this.options.path_images+'/icon_fullscreen.png" alt="'+this.strings.reload+'"/><span onclick="'+this.options.globalObjectName+".trigger('switchFullscreen');\">"+this.strings.fullscreen_close+"</span></div>",t+='  <div title="'+this.strings.help_reload+'" class="tt-help layout-button layout-button-reload"><img onclick="'+this.options.globalObjectName+".trigger('reload');\" src=\""+this.options.path_images+'/icon_refresh.png" alt="'+this.strings.reload+'" /><span onclick="'+this.options.globalObjectName+".trigger('reload');\">"+this.strings.reload+"</span></div>",this.getContainerByType("list")&&(this.options.autoFollow?t+='  <div title="'+this.strings.help_autofollow+'" class="tt-help layout-button layout-button-follow"><img onclick="'+this.options.globalObjectName+".trigger('autoFollow', false);\" src=\""+this.options.path_images+'/icon_autofollow_active.png" alt="'+this.strings.auto_follow+'" /><span onclick="'+this.options.globalObjectName+".trigger('autoFollow', false);\">"+this.strings.auto_follow+"</span></div>":t+='  <div title="'+this.strings.help_autofollow+'" class="tt-help layout-button layout-button-follow"><img onclick="'+this.options.globalObjectName+".trigger('autoFollow', true);\" src=\""+this.options.path_images+'/icon_autofollow.png" alt="'+this.strings.auto_follow+'" /><span onclick="'+this.options.globalObjectName+".trigger('autoFollow', true);\">"+this.strings.auto_follow+"</span></div>"),this.options.help&&(t+='  <div title="" class="tt-help-info layout-button layout-button-help"><img src="'+this.options.path_images+'/icon_help.png" alt="" /><span>'+this.strings.help+"</span></div>"),t},renderMain:function(){var t="";t+='<div class="list-head">'+this.options.title,t+='  <div class="list-option-buttons hideable">',t+=this.renderMainButtons(),t+="  </div>",t+="</div>",t+='<div class="lb-containers">',"jqm"==this.options.theme&&(t+='<ul class="resultsboard-wrap" data-role="listview"><li class="resultsboard-wrap-li">'),void 0!==this.data.global.global_option_bar&&(t+=this.renderOptionBar());for(var e in this.data.global.options.cols)this.data.global.options.cols.hasOwnProperty(e)&&(t+='<div class="lb-col col-id-'+this.data.global.options.cols[e].id+'"></div>');return"jqm"==this.options.theme&&(t+="</li></ul>"),t+="</div>",t+='<div class="list-footer">',1==this.data.settings.global_event_official_show&&(t+='<p class="event-official">'+this.data.settings.global_event_official_string+"</p>"),t+="</div>"},clearCols:function(){jQuery(".lb-col").html("")},trigger:function(t,e){switch(this.log("Trigger: "+t,"info"),t){case"reload":this.load();break;case"refresh":this.refresh();break;case"replayPlay":this.replayStart();break;case"replayStop":this.replayStop();break;case"replayRewind":this.replayRewind();break;case"setSelector":e.key&&e.container&&(this.subSelectorState[e.container]=e.key,this.options.autoFollow=!1,this.renderContainers(e.container),jQuery(".resultsboard-"+this.options.globalObjectName+" .list-option-buttons").html(this.renderMainButtons()));break;case"autoFollow":e?(this.options.autoFollow=!0,this.subSelectorState={}):this.options.autoFollow=!1,this.addToRenderQueue("list"),this.renderFromQueue(),jQuery(".resultsboard-"+this.options.globalObjectName+" .list-option-buttons").html(this.renderMainButtons());break;case"showDetails":this.data.global.options.show_details=!!e,this.addToRenderQueue("favorites"),this.renderFromQueue();break;case"openFavoriteDetails":this.openFavoriteDetails(e.id_favorite,e);break;case"closeFavoriteDetails":this.closeFavoriteDetails(e.id_favorite,e);break;case"addFavorite":"none"!=this.data.global.options.favorites_mode&&-1==this.favorites.indexOf(e.id)&&(this.favorites.push(e.id),this.options_submit.command={name:"addFavorite",id:e.id},this.addToRenderQueue("list"),this.addToRenderQueue("map"),this.load());break;case"removeFavorite":if("none"!=this.data.global.options.favorites_mode){o=[];if(-1!=(i=this.favorites.indexOf(e.id))){for(r in this.favorites)this.favorites.hasOwnProperty(r)&&this.favorites[r]!=e.id&&o.push(this.favorites[r]);this.favorites=o,this.options_submit.command={name:"removeFavorite",id:e.id},this.addToRenderQueue("list"),this.addToRenderQueue("map"),this.load()}}break;case"clearFavorites":this.favorites=[],this.options_submit.command={name:"clearFavorites",id:e.id},this.load(),this.renderContainers();break;case"selectFavoriteToggle":-1!=(i=this.favorites.indexOf(e.id))&&(-1!=this.favoritesSelected.indexOf(e.id)?this.trigger("deselectFavorite",{id:e.id}):this.trigger("selectFavorite",{id:e.id}));break;case"selectFavorite":-1!==(i=this.favorites.indexOf(e.id))&&this.favoritesSelected.push(e.id);break;case"deselectFavorite":var i;if(-1!==(i=this.favorites.indexOf(e.id))){var s=this.favorites[i],o=[];for(r in this.favoritesSelected)this.favoritesSelected.hasOwnProperty(r)&&s!=this.favoritesSelected[r]&&o.push(this.favoritesSelected[r]);this.favoritesSelected=o}break;case"submitOptions":o=[];jQuery(".resultsboard-"+this.options.globalObjectName+" form").each(function(t,e){"lb"==e.name&&(o=jQuery(this).serializeArray())});var a={};for(var r in o)o.hasOwnProperty(r)&&("field_"==o[r].name.substr(0,6)&&(a[o[r].name.substr(6)]=o[r].value),"option_"==o[r].name.substr(0,7)&&(a[o[r].name.substr(7)]=o[r].value));this.replay_time_max=0,this.replay_time=0,this.replay_speed=0,this.options_submit.option_bar=a,this.load();break;case"centerMap":this.mapAutoZoom=!1,this.mapCenter(e.container);break;case"switchFullscreen":this.switchFullscreen();break;case"switchControls":jQuery(".resultsboard-"+this.options.globalObjectName+".list").hasClass("hide-on")?jQuery(".resultsboard-"+this.options.globalObjectName+".list").removeClass("hide-on"):jQuery(".resultsboard-"+this.options.globalObjectName+".list").addClass("hide-on");break;case"switchControlsExtended":jQuery(".resultsboard-"+this.options.globalObjectName+".list").hasClass("hide-on")?(jQuery(".resultsboard-"+this.options.globalObjectName+".list").removeClass("hide-on"),jQuery(".resultsboard-"+this.options.globalObjectName+".list").removeClass("hide-on-extended")):(jQuery(".resultsboard-"+this.options.globalObjectName+".list").addClass("hide-on"),jQuery(".resultsboard-"+this.options.globalObjectName+".list").addClass("hide-on-extended"));break;case"switchAutoZoom":this.mapAutoZoom?(this.mapAutoZoom=!1,jQuery(".resultsboard-"+this.options.globalObjectName+" .button-map-autozoom").removeClass("button-active")):(this.mapAutoZoom=!0,jQuery(".resultsboard-"+this.options.globalObjectName+" .button-map-autozoom").addClass("button-active"));for(var r in this.data.containers)this.data.containers.hasOwnProperty(r)&&"map"==this.data.containers[r].type&&this.mapUpdate(r);break;case"switchOverlayMenu":(p=jQuery(".resultsboard-"+this.options.globalObjectName+" .overlayMenu")).css({display:"block"});var n=p.position(),l=p.offset(),d=n.top+(e.top-l.top),h=n.left+(e.left-l.left);p.css({display:"block",left:h+"px",top:d+"px"});break;case"switchOverlay":if(-1!==this.mapOverlays.indexOf(e.overlayId)){o=[];for(var r in this.mapOverlays)this.mapOverlays.hasOwnProperty(r)&&this.mapOverlays[r]!=e.overlayId&&o.push(this.mapOverlays[r]);this.mapOverlays=o,jQuery(".overlayMenu #overlayButton-"+e.overlayId).removeClass("active")}else this.mapOverlays.push(e.overlayId),jQuery(".overlayMenu #overlayButton-"+e.overlayId).addClass("active");window.setTimeout(this.options.globalObjectName+'.trigger("closeOverlayMenu")',350);break;case"closeOverlayMenu":(p=jQuery(".resultsboard-"+this.options.globalObjectName+" .overlayMenu")).css({display:"none"});for(var r in this.data.containers)this.data.containers.hasOwnProperty(r)&&"map"==this.data.containers[r].type&&this.mapUpdateOverlays(r);break;case"openInfoWindow":(p=jQuery(".resultsboard-"+this.options.globalObjectName+" .mapInfoWindow")).css({display:"block"});n=p.position(),l=p.offset(),d=e.top,h=e.left;p.css({display:"block",left:h+"px",top:d+"px"}),p.html(e.html);break;case"closeInfoWindow":var p;(p=jQuery(".resultsboard-"+this.options.globalObjectName+" .mapInfoWindow")).css({display:"none"})}},render:function(){jQuery(this.targetElement).html(this.renderMain()),this.renderContainers()},renderFromQueue:function(){for(var t in this.renderQueue)if(this.renderQueue.hasOwnProperty(t))for(var e in this.data.containers)this.data.containers.hasOwnProperty(e)&&this.data.containers[e].type==this.renderQueue[t]&&this.renderContainers(e);this.clearRenderQueue()},renderContainers:function(t){for(var e in this.data.containers)if(this.data.containers.hasOwnProperty(e)&&!(t&&e!=t||"map"!=this.data.containers[e].type&&"favorites"!=this.data.containers[e].type&&"list"!=this.data.containers[e].type&&"overlays"!=this.data.containers[e].type)){if(this.data.containers[e].state,"overlays"!=this.data.containers[e].type)if(jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-container.container-id-"+e).length)if("favorites"==this.data.containers[e].type){var i=jQuery(".favorite-boxes .favorite-wrap").length,s=0;if(void 0!==this.data.containers[e].data.rows)for(var o in this.data.containers[e].data.rows)s++;i!=s?jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-container.container-id-"+e).html(this.renderContainer(e,!0)):this.updateContainerContentTypeFavorites(e)}else jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-container.container-id-"+e).html(this.renderContainer(e,!0));else{var a=this.renderContainer(e,!1);jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-col.col-id-"+this.data.containers[e].col).append(a)}if("map"==this.data.containers[e].type&&this.mapInit(e),"favorites"==this.data.containers[e].type)for(var r in this.data.containers)this.data.containers.hasOwnProperty(r)&&"map"==this.data.containers[r].type&&this.mapUpdate(r);if("overlays"==this.data.containers[e].type)for(var r in this.data.containers)this.data.containers.hasOwnProperty(r)&&"map"==this.data.containers[r].type&&this.mapUpdateOverlays(r)}var n="";for(var l in this.data.global.options.cols)this.data.global.options.cols.hasOwnProperty(l)&&(n+=".lb-col.col-id-"+this.data.global.options.cols[l].id,l+1<this.data.global.options.cols.length&&(n+=","));var d=this.options.globalObjectName;jQuery(n).sortable({connectWith:".resultsboard-"+this.options.globalObjectName+" .lb-col",placeholder:"lb-sortable-placeholder",distance:20,handle:".drag",update:function(t,e){window[d].renderContainers()}});var h=this.options_submit,p=this.options.pid;if(jQuery(".resultsboard-"+d+" input#autocomplete").autocomplete({source:function(t,e){h.string=t.term,jQuery.ajax({url:"index.php?content=ajax2&onpage="+p,type:"GET",data:{func:"getSearchResult",options:h},success:function(t){t.length?(jQuery(".resultsboard-"+d+" .leaderboard-search input").tooltip("close"),jQuery(".resultsboard-"+d+" .leaderboard-search input").tooltip("disable")):(jQuery(".resultsboard-"+d+" .leaderboard-search input").tooltip("enable"),jQuery(".resultsboard-"+d+" .leaderboard-search input").tooltip("open")),e(t)}})},minLength:1,delay:this.data.global.options.search_delay,autoFocus:!0,select:function(t,e){return window[d].trigger("addFavorite",{id:e.item.id}),!0}}),this.data.global.options.focus_input&&jQuery(".resultsboard-"+this.options.globalObjectName+" input#autocomplete").focus(),this.registerEvents(),this.registerTooltips(),"jqm"==this.options.theme&&(jQuery(".resultsboard-"+this.options.globalObjectName+" .lb-containers").trigger("create"),applySizes()),1==this.data.settings.global_event_official_show){var c=jQuery(".resultsboard-"+this.options.globalObjectName+" .event-official");c.length?jQuery(c).html(this.data.settings.global_event_official_string):jQuery(".resultsboard-"+this.options.globalObjectName+" .list-footer").append('<p class="event-official">'+this.data.settings.global_event_official_string+"</p>")}else jQuery(".resultsboard-"+this.options.globalObjectName+" .event-official").remove();"undefined"!=typeof require&&require(["Mika/Mika"],function(t){(new t).emit("results/board.rendered")})},registerTooltips:function(){jQuery(".resultsboard-"+this.options.globalObjectName+" .leaderboard-search input").tooltip({tooltipClass:"tooltip-warning",show:{delay:0},position:{my:"center bottom",at:"center top"},content:this.strings.not_found,items:"input"}),jQuery(".resultsboard-"+this.options.globalObjectName+" .leaderboard-search input").tooltip("disable"),this.options.isTouchDevice||(jQuery(".tt-help").tooltip({tooltipClass:"tooltip-help",show:{delay:400},position:{my:"center top-45",at:"center top"},items:"a,span,button,div"}),jQuery(".tt-help.tt-oninit.tt-pos-bottom").tooltip({tooltipClass:"tooltip-help tooltip-icon-info tt-pos-bottom",show:{delay:2500},position:{my:"center top+4",at:"center bottom",collision:"none"},items:"a,span,button,div"}),jQuery(".tt-help.tt-oninit.tt-pos-top").tooltip({tooltipClass:"tooltip-help tooltip-icon-info tt-pos-top",show:{delay:2500},position:{my:"center bottom-10",at:"center top",collision:"none"},items:"a,span,button,div"}),jQuery(".resultsboard-"+this.options.globalObjectName+" .tt-oninit").tooltip("enable"),jQuery(".resultsboard-"+this.options.globalObjectName+" .tt-oninit").tooltip("open"),jQuery(".tt-help.tt-oninit").tooltip({show:{delay:400}})),jQuery(".tt-help-info").tooltip({tooltipClass:"tooltip-help-info",show:{delay:400,effect:"slideDown"},position:{my:"right top",at:"right bottom"},content:this.options.help})},renderContainer:function(t,e){var i,s=this.data.containers[t],o="",a="",r=s.title;if(void 0!==s.data.sub_selector){if(this.subSelectorState[t]&&(s.data.rows[this.subSelectorState[t]]||(this.subSelectorState[t]=!1)),!this.subSelectorState[t])for(i in s.data.sub_selector)s.data.sub_selector.hasOwnProperty(i)&&s.data.sub_selector[i].has_data&&(this.subSelectorState[t]=i);if(this.options.autoFollow)for(i in s.data.sub_selector)s.data.sub_selector.hasOwnProperty(i)&&s.data.sub_selector[i].has_data&&(this.subSelectorState[t]=i);this.subSelectorState[t]||(this.subSelectorState[t]=0);for(i in s.data.sub_selector)if(s.data.sub_selector.hasOwnProperty(i)&&i==this.subSelectorState[t])var n=s.data.sub_selector[i].name;this.data.global.options.append_subselector_title&&(r=s.title+" <span>"+n+"</span>")}switch(this.options.theme){case"jqm":e||(o+='<div class="lb-container container-id-'+t+'" id="container_'+t+'">'),o+='<ul data-inset="false" data-role="listview">',o+='<li data-role="list-divider">'+s.title+"</li>",o+="<li>",o+=' <div class="lb-container-content" id="container-content-'+t+'">',(a=this.renderContainerContent(t))&&(o+=a),o+=" </div>",o+="</li>",o+="</ul>",e||(o+="</div>");break;default:e||(o+='<div class="lb-container container-id-'+t+'" id="container_'+t+'">'),o+=' <div class="container-info">',o+='  <div class="container-headline">'+r+"</div>",o+='  <div class="list-options hideable">',o+='   <span class="drag"><img src="'+this.options.path_images+'/icon_drag.gif" alt="'+this.strings.move+'" title="'+this.strings.move+'" /></span>',o+="  </div>",o+=" </div>";"",o+=' <div class="lb-container-content" id="container-content-'+t+'">';(a=this.renderContainerContent(t))&&(o+=a),o+=" </div>",e||(o+="</div>")}return o},renderContainerContent:function(t){var e="";switch(this.data.containers[t].type){case"list":e=this.renderContainerContentTypeList(t);break;case"favorites":e=this.renderContainerContentTypeFavorites(t);break;case"map":e=this.renderContainerContentTypeMap(t)}return e},renderTrendField:function(t,e,i,s){var o="";switch("object"!=typeof t[e.field]&&(t[e.field]={value:t[e.field]}),t[e.field].value){case"plus":s="icon_up.gif";break;case"minus":s="icon_down.gif";break;default:s="icon_even.gif"}var a="",r="";return void 0!==e.type_data&&void 0!==e.type_data.view_places&&!0===e.type_data.view_places&&"~"!=t[e.field].trend_place_diff.modifier&&"unknown"!=t[e.field].value?r="&nbsp;<small>"+(">"==t[e.field].trend_place_diff.modifier?"&gt;":t[e.field].trend_place_diff.modifier)+t[e.field].trend_place_diff.places+"</small>":void 0!==t[e.field].trend_place_diff&&"plus"==t[e.field].value|"minus"==t[e.field].value&&(a=t[e.field].trend_place_diff.modifier+""+t[e.field].trend_place_diff.places),o+="<td"+i+'><img src="'+this.options.path_images+"/"+s+'" title="'+a+'" alt="">',o+=r,o+="</td>"},renderContainerContentTypeList:function(t){var e,i,s,o,a,r=this.data.containers[t],n="",l="",d="",h="",p="",c=!1;void 0!==r.data.sub_selector?(n+=this.renderSubSelector(t),e=r.data.rows[this.subSelectorState[t]]):e=r.data.rows;var u=!1;for(s in this.data.containers)if(this.data.containers.hasOwnProperty(s)&&"favorites"==this.data.containers[s].type){u=this.data.containers[s];break}if(u){var g=[];for(s in u.data.rows)if(u.data.rows.hasOwnProperty(s)){var f=u.data.rows[s];f.id&&g.push(f.id)}}else g=this.favorites;switch(n+="",this.options.theme){case"jqm":n+='<ul data-role="listview" data-split-icon="plus" data-split-theme="a">';break;default:n+='<table border="0" cellspacing="0" cellpadding="0" class="list-table"><thead>',n+="<tr>","none"!=this.data.global.options.favorites_mode&&(n+='<td class="color last">&nbsp;</td>');var m=0;for(s in r.data.fields.data)r.data.fields.data.hasOwnProperty(s)&&m++;var _=0;for(s in r.data.fields.data)r.data.fields.data.hasOwnProperty(s)&&((i=r.data.fields.data[s]).width||(i.width="auto"),l="",i.class&&(l+=i.class),_+1==m&&(l+=" last"),l&&(l=' class="'+l+'"'),n+="<td"+l+' style="width:'+i.width+'">'+i.name+"</td>",_++);n+="</tr></thead>"}if(e.length){switch(this.options.theme){case"jqm":break;default:var v=0;for(void 0!==r.data.options.num_results&&e.length<r.data.options.num_results&&(v=e.length<=r.data.options.max_results?r.data.options.max_results-e.length:r.data.options.num_results-e.length),s=0;s<v;s++)e.push({})}for(s in e)if(e.hasOwnProperty(s)){a=e[s],d="",h="",c=!1;var y=!1;for(o in a)if(a.hasOwnProperty(o)){y=!0;break}switch(s%2&&(d+=" list-highlight"),-1!=this.favorites.indexOf(a.id)&&"none"!=this.data.global.options.favorites_mode&&(d+=" favorite",c=!0),d=' class="'+d+'"',this.options.theme){case"jqm":if(void 0===a.id)n+="<li>";else{h+=' style="cursor:pointer"';var b="?content=detail&amp;fpid=search&amp;pid=search&amp;idp="+a.id+"&amp;lang="+this.options.lang+"&amp;event="+this.data.settings.global_event;n+="<li "+(c?'class="favorite" data-icon="delete" data-theme="b"':"")+'><a href="'+b+'">'}break;default:if(void 0===a.id?n+='<tr style="cursor:default"'+d+">":n+="<tr onmouseover=\"jQuery(this).addClass('mark');\" onmouseout=\"jQuery(this).removeClass('mark');\""+d+h+">","none"!=this.data.global.options.favorites_mode){var k="";k=this.data.global.options.favorite_titles[this.favorites.indexOf(a.id)]?this.data.global.options.favorite_titles[this.favorites.indexOf(a.id)]:"",k=this.data.global.options.favorite_titles[g.indexOf(a.id)]?this.data.global.options.favorite_titles[g.indexOf(a.id)]:"",n+='<td class="color last"><div class="fav-color i-'+g.indexOf(a.id)+'">'+k+"</div></td>"}}_=0;for(var w in r.data.fields.data)if(r.data.fields.data.hasOwnProperty(w)){i=r.data.fields.data[w],l="",p=y?i.type:"fillup",i.class&&(l+=i.class),_+1==m&&(l+=" last");var j="";switch("add_favorite"==p&&(l+=" icon s favorite-toggle"),l&&(j=' class="'+l+'"'),this.options.theme){case"jqm":switch(p){case"add_favorite":break;case"trend":a[i.field]?n+=this.renderTrendField(a,i,j,""):n+="<span></span>";break;default:"name"==i.role?n+="<h3>"+(void 0!==a[i.field]&&null!=a[i.field]?a[i.field]:"")+"</h3>":"actual_split_time"==i.field?n+='<div class="field time'+l+'"><span class="desc">'+i.name+"</span>"+(void 0!==a[i.field]&&null!=a[i.field]?a[i.field]:"")+"</div>":n+='<div class="field '+l+'"><span class="desc">'+i.name+"</span>"+(void 0!==a[i.field]&&null!=a[i.field]?a[i.field]:"")+"</div>"}break;default:switch(p){case"add_favorite":n+=c?"<td"+j+' onclick="'+this.options.globalObjectName+".trigger('removeFavorite', {id:'"+a.id+"', container:'"+t+'\'}); return false;"><img style="cursor:pointer" title="'+this.strings.add_favorite_list+'" src="'+this.options.path_icons+'/icons/check.svg" onmouseover="this.src=\''+this.options.path_icons+"/icons/delete.svg';\" onmouseout=\"this.src='"+this.options.path_icons+'/icons/check.svg\';"  alt=""></td>':"<td"+j+' onclick="'+this.options.globalObjectName+".trigger('addFavorite', {id:'"+a.id+"', container:'"+t+'\'}); return false;"><img style="cursor:pointer" title="'+this.strings.add_favorite_list+'" src="'+this.options.path_icons+'/icons/add.svg" alt=""></td>';break;case"trend":a[i.field]?n+=this.renderTrendField(a,i,j,""):n+="<td"+j+"></td>";break;case"fillup":n+="<td"+j+">&nbsp;</td>";break;default:n+="<td"+j+">"+(void 0!==a[i.field]&&null!=a[i.field]?a[i.field]:"")+"</td>"}}_++}switch(this.options.theme){case"jqm":n+=c?'</a><a href="#" data-ajax="false" onclick="'+this.options.globalObjectName+".trigger('removeFavorite', {id:'"+a.id+"', container:'"+t+"'}); return false;\" onmouseover=\"jQuery(this).addClass('mark');\" onmouseout=\"jQuery(this).removeClass('mark');\""+d+h+"></a></li>":'</a><a href="#" data-ajax="false" onclick="'+this.options.globalObjectName+".trigger('addFavorite', {id:'"+a.id+"', container:'"+t+"'}); return false;\" onmouseover=\"jQuery(this).addClass('mark');\" onmouseout=\"jQuery(this).removeClass('mark');\""+d+h+"></a></li>";break;default:n+="</tr>"}}}else{var C=5;switch(r.data.options.num_results&&(C=r.data.options.num_results),this.options.theme){case"jqm":n+='<li><div class="results-message">'+this.strings.no_results+"</div></li>";break;default:n+='<tr><td class="message-cell" colspan="'+(_+1)+'" style="height:'+18*C+'px; text-align:center;border-right:0;"><div class="results-message">'+this.strings.no_results+"</div></div></td></tr>"}}switch(this.options.theme){case"jqm":n+="</ul>";break;default:n+="</table>"}return n},renderOptionBar:function(t){var e,i="";if(void 0!==this.data.global.global_option_bar&&this.data.global.global_option_bar.fields.length){var s=this.data.global.global_option_bar;if(t||(i+='<div class="optionbar hideable" id="optionbar-global">'),i+='<form action="" id="lb" name="lb">',void 0!==s.fields&&s.fields.length)for(var o in s.fields)if(s.fields.hasOwnProperty(o)){var a=s.fields[o];switch(this.options.theme){case"jqm":s.fields.length>1?(i+='<div data-role="fieldcontain" class="ui-hide-label optionbar-option option-left">',i+='<label for="field_'+a.name+'">'+a.title+"</label> ",i+='<select data-mini="true" data-inline="true" name="field_'+a.name+'" id="field_'+a.name+'" onchange="'+this.options.globalObjectName+".trigger('submitOptions');\">"):(i+='<div data-role="fieldcontain" class="ui-hide-label optionbar-option">',i+='<label for="field_'+a.name+'">'+a.title+"</label> ",i+='<select data-mini="true" name="field_'+a.name+'" id="field_'+a.name+'" onchange="'+this.options.globalObjectName+".trigger('submitOptions');\">");break;default:i+='<div class="optionbar-option option-left">',i+="<span>"+a.title+"</span> ",i+='<select name="field_'+a.name+'" id="field_'+a.name+'" onchange="'+this.options.globalObjectName+".trigger('submitOptions', {triggerField:'"+a.name+"'});\">"}var r="";for(var n in a.data)break;if(void 0!==a.data[n].index){a.data.sort(function(t,e){return t.index==e.index?0:t.index<e.index?-1:1});var l={};jQuery.each(a.data,function(t,e){l[e.key]=e.name}),a.data=l}for(e in a.data)a.data.hasOwnProperty(e)&&(r="",a.selected==e&&(r=' selected="selected"'),"%"==e&&"jqm"==this.options.theme&&(a.data[e]=a.title+": "+a.data[e]),i+='<option value="'+e+'"'+r+">"+a.data[e]+"</option>",0);i+="</select>",i+="</div>"}if(void 0!==s.options&&void 0!==s.options.hideable&&s.options.hideable&&(i+="<a href=\"#\" onclick=\"jQuery('#optionbar-global').css('display','none');\">Hide</a>"),void 0!==s.options.limits&&s.options.limits.length){switch(this.options.theme){case"jqm":i+='<div data-role="fieldcontain" class="ui-hide-label optionbar-option option-right">',i+='<select name="option_limit" id="option_limit" onchange="'+this.options.globalObjectName+".trigger('submitOptions');\">";break;default:i+='<div class="optionbar-option option-right">',i+='<select name="option_limit" id="option_limit" onchange="'+this.options.globalObjectName+".trigger('submitOptions');\">"}for(e in s.options.limits)s.options.limits.hasOwnProperty(e)&&(r="",void 0!==this.data.settings&&this.data.settings.limit==s.options.limits[e]&&(r=' selected="selected"'),i+='<option value="'+s.options.limits[e]+'"'+r+">TOP "+s.options.limits[e]+"</option>");i+="</select>",i+="</div>"}if("undefined"!=s.options.show_last_update&&!0===s.options.show_last_update)switch(this.options.theme){case"jqm":break;default:i+='<div class="optionbar-option option-right">',i+=this.strings["resultsboard.last_update"]+' <span data-type="lastupdatetimestamp">',void 0!==s.options.last_update_count_up&&!0===s.options.last_update_count_up?i+='<time datetime="'+this.data.lastUpdateTs+'" data-direction="up">00:00</time>':i+=this.formatTime(new Date),i+="</span>",i+="</div>"}i+='<div style="clear:both"></div>',i+="</form>",t||(i+="</div>")}return void 0!==s.options&&void 0!==s.options.hideable&&s.options.hideable&&(i+="<a class=\"hidebutton\" href=\"#\" onclick=\"jQuery('optionbar-global').css('display','block');\">.</a>"),t?(jQuery("#optionbar-global").html(i),""):i},renderSubSelector:function(t){var e,i,s,o,a,r,n,l="",d="",h="",p="",c="",u=this.data.containers[t];if("auto"==u.data.options.sub_selector_mode&&(r=jQuery(".lb-container.container-id-"+t).width()?jQuery(".lb-container.container-id-"+t).width()/u.data.sub_selector.length-1:jQuery(".lb-col.col-id-"+u.col).width()/u.data.sub_selector.length-1,u.data.options.sub_selector_mode=r>30?"buttons":"dropdown"),"buttons"==u.data.options.sub_selector_mode){switch(this.options.theme){case"jqm":l+='<div data-role="controlgroup" data-type="horizontal" class="status" style="width: 100%;">';break;default:u.data.options.sub_selector_class?l+='<div class="status hideable-extended '+u.data.options.sub_selector_class+'">':l+='<div class="status hideable-extended">'}for(e in u.data.sub_selector)u.data.sub_selector.hasOwnProperty(e)&&u.data.sub_selector[e].has_data&&e;if(r=0,n="","calc"==u.data.options.sub_selector_width)switch(this.options.theme){case"jqm":r=100/u.data.sub_selector.length,r-=.1*(u.data.sub_selector.length+1),n="%;";break;default:r=jQuery(".lb-container.container-id-"+t).width()?jQuery(".lb-container.container-id-"+t).width()/u.data.sub_selector.length-1:jQuery(".lb-col.col-id-"+u.col).width()/u.data.sub_selector.length-1,n="px;"}else u.data.options.sub_selector_width&&(r=u.data.options.sub_selector_width);isNaN(r)||(r*=u.data.options.sub_selector_width_factor),s=r+n,i=0;for(e in u.data.sub_selector)if(u.data.sub_selector.hasOwnProperty(e)){switch(o=u.data.sub_selector[e],p="",d="",h="width:"+s,o.color&&(h+="background-color:"+o.color+";"),o.class&&(d+=o.class+" "),a=!1,e==this.subSelectorState[t]&&(d+="selected ",p+=' data-theme="a"',a=!0),o.has_data&&(d+="active ",a||(p+=' data-theme="b"')),i+1==u.data.sub_selector.length&&(d+="last "),h&&(h='style="'+h+'" '),this.options.theme){case"jqm":l+="<a "+p+' data-role="button" '+h+'onclick="'+this.options.globalObjectName+".trigger('setSelector', {key:'"+e+"', container:'"+t+'\'}); return false;" href="#" class="'+d+'"><span>'+o.name+"</span></a>";break;default:l+="<a "+h+'onclick="'+this.options.globalObjectName+".trigger('setSelector', {key:'"+e+"', container:'"+t+'\'}); return false;" href="#" class="'+d+'"><span>'+o.name+"</span></a>"}i++}l+="</div>"}else if("dropdown"==u.data.options.sub_selector_mode){l+='<select data-mini="true" class="sub_selector" onchange="'+this.options.globalObjectName+".trigger('setSelector', {key:this.value, container:'"+t+"'}); return false;\" >";for(var g in u.data.sub_selector)u.data.sub_selector.hasOwnProperty(g)&&(o=u.data.sub_selector[g],c="",g==this.subSelectorState[t]&&(c=' selected="selected"'),o.has_data,l+='<option value="'+g+'"'+c+">"+o.name+"</option>");l+="</select>"}return l},updateContainerContentTypeFavorites:function(t,e){var i,s=this.data.containers[t];for(i in s.data.rows)s.data.rows.hasOwnProperty(i)&&s.data.rows[i].id&&this.renderFavorite(s.data.rows[i],s.data.fields.data,s.data.options,"",i,!0,e);if("position"==s.data.options.order_by)for(var o in s.data.split_groups.data){var a=s.data.split_groups.data[o].name;jQuery(".favorite-boxes .split-group-"+a+" .replay-barrier").remove();for(i in this.favoritesOrderLive[a])this.favoritesOrderLive[a].hasOwnProperty(i)&&jQuery("#f-"+this.favoritesOrderLive[a][i]).appendTo(".favorite-boxes .split-group-"+a);if(this.data.global.options.replay_mode&&this.favoritesOrderReplay[a]&&this.favoritesOrderReplay[a].length){jQuery(".favorite-boxes .split-group-"+a).append('<div class="replay-barrier"><span>REPLAY</span></div>');for(i in this.favoritesOrderReplay[a])this.favoritesOrderReplay[a].hasOwnProperty(i)&&jQuery("#f-"+this.favoritesOrderReplay[a][i]).appendTo(".favorite-boxes .split-group-"+a)}}},renderContainerContentTypeFavorites:function(t){var e=this.data.containers[t],i="";i+='<div class="status buttons favorites hideable">',this.data.global.options.show_clear_button&&(i+=' <a href="#" onclick="'+this.options.globalObjectName+".trigger('clearFavorites'); return false;\">"+this.strings.clear+"</a>"),this.data.global.options.show_search&&(i+=' <div class="leaderboard-search"><span class="caption">'+this.strings.add_favorite+'</span> <input type="text" id="autocomplete" name="autocomplete_parameter" onfocus="this.value=\'\';this.style.color=\'#333333\';" onblur="this.style.color=\'#AAAAAA\'; this.value=\''+this.strings.search_help+'\'" value="'+this.strings.search_help+'" /></div>'),this.data.global.options.show_details_button&&(i+=' <div class="leaderboard-details"><span class="caption">'+this.strings.show_details+'</span> <input onclick="'+this.options.globalObjectName+".trigger('showDetails', this.checked); return false;\" "+(this.data.global.options.showDetails?" checked":"")+' type="checkbox" id="show_details" name="show_details" value="1" /></div>'),i+="</div>",i+='<div class="favorite-boxes">';var s=2;if(this.data.global.options.favorite_cols&&(s=this.data.global.options.favorite_cols),s=parseInt(s),"calc"==e.data.options.width){var o="";(o=jQuery(".lb-container.container-id-"+t).width()?jQuery(".lb-container.container-id-"+t).width()/s:jQuery(".lb-col.col-id-"+e.col).width()/s)<220&&(s=1,o=jQuery(".lb-container.container-id-"+t).width()?jQuery(".lb-container.container-id-"+t).width()/s:jQuery(".lb-col.col-id-"+e.col).width()/s),s>1&&(o-=4,o+=3/s),o+="px;"}else o=!!e.data.options.width&&e.data.options.width;var a=!1;for(var r in e.data.split_groups.data){var n=e.data.split_groups.data[r];if(e.data.split_groups.data.length>1&&e.data.options.use_split_groups){if(o)var l="width:"+o+";";else l="";(r+1)%s==0&&(l+="margin-right:0;"),i+='<div style="'+l+'" class="split-group split-group-'+n.name+'">',i+='<div class="label"><span>'+n.title+"</span></div>"}else i+='<div style="margin-right:0" class="split-group split-group-'+n.name+'">';for(var d in e.data.rows){if(o)l="width:"+o+";";else l="";if(e.data.rows.hasOwnProperty(d)&&e.data.rows[d].id){var h=!1,p=!1;jQuery.each(e.data.rows[d].split_groups,function(t,e){e.active&&(h=e,p=t)}),h||jQuery.each(e.data.rows[d].split_groups,function(t,e){return h=e,p=t,!1}),e.data.options.use_split_groups&&h.name!=n.name||(a=!0,d=parseInt(d),i+=this.renderFavorite(e.data.rows[d],e.data.fields.data,e.data.options,l,d))}}if(i+="</div>",!e.data.options.use_split_groups)break}return a||(this.data.global.options.replay_mode?i+='<div class="results-message">'+this.strings.help_favorites_replay+"</div>":i+='<div class="results-message">'+this.strings.help_favorites+"</div>"),i+="</div>"},renderFavorite:function(t,e,i,s,o,a,r){var n=[],l=!1,d="";for(var h in e)if(e.hasOwnProperty(h)){var p=e[h];p.active&&(p.split||-1==p.field.search("time_finish_")&&-1!=p.field.search("place")&&(n.push(p),t[p.field]>0&&(l=!0)))}var c=this.renderFavoritesHead(t,e,o,i);if(c+='<div class="info-table-wrap fields-primary">',c+=this.renderFavoritesPrimaryFields(t,e,i),c+="</div>",l&&n.length,i.collapsible||(n.length>1&&(c+='<div class="info-table-wrap places">',c+=this.renderFavoritesPlaces(t,n,i),c+="</div>"),this.data.global.options.show_details&&(c+='<div class="info-table-wrap splits">',c+=this.renderFavoritesSplits(t,e,i),c+="</div>")),i.collapsible&&!r){var u=this.renderFavoritesHead(t,e,o,i);u+='<div class="info-table-wrap fields-secondary">',u+=this.renderFavoritesSecondaryFields(t,e,i),u+="</div>",n.length>1&&(u+='<div class="info-box info-box-places">',u+=this.renderFavoritesPlaces(t,n,i),u+="</div>"),this.data.global.options.show_details&&(u+='<div class="info-box info-box-splits">',u+=this.renderFavoritesSplits(t,e,i),u+="</div>"),u+='<div class="info-buttons">',u+='<a onclick="'+this.options.globalObjectName+".trigger('closeFavoriteDetails', {id_favorite:'"+t.id+'\'}); return false;" class="button-secondary close">close details</a>',u+="<span>drag box to detach</span>",u+="</div>"}if(!a){s=' style="'+s+'"';var g="info-box favorite-wrap";if(g+=" index-"+o,o%2&&(g+=" highlight"),this.options.addFavorite==t.id&&(g+=" favorite-active"),d+='<div class="'+g+'"'+s+' id="f-'+t.id+'">',d+='<div class="sensitive">',d+='  <div class="info-primary">',d+=c,d+="  </div>",i.collapsible){d+='<div class="info-buttons">',d+='<a id="b-'+t.id+'" class="button-secondary open">show details</a>',d+='<div style="clear:both"></div>',d+="</div>";var f=this.options.globalObjectName;this.events.click.push({selector:"#f-"+t.id+" .button-secondary.open",func:function(e){window[f].openFavoriteDetails(t.id,{top:e.pageY,left:e.pageX})}}),this.events.mouseover.push({selector:"#f-"+t.id+" .sensitive",func:function(e){jQuery("#f-"+t.id).addClass("mouseover")}}),this.events.mouseout.push({selector:"#f-"+t.id+" .sensitive",func:function(e){jQuery("#f-"+t.id).removeClass("mouseover")}})}return d+="</div>",i.collapsible&&(d+='<div class="info-secondary">',d+=u,d+="</div>"),d+="</div>"}jQuery("#f-"+t.id+" .info-primary").html(c),i.collapsible&&!r&&jQuery("#f-"+t.id+" .info-secondary").html(u)},renderFavoritesPrimaryFields:function(t,e,i){var s=[],o="";t.is_in_replay&&(o+='<div class="replay-info">R</div>');var a=0,r=0;for(var n in e)if(e.hasOwnProperty(n)){(l=e[n]).active&&(l.split||-1==l.field.search("time_finish_")&&(-1==l.field.search("place")?i.collapsible&&!l.primary||l.hide||r++:s.push(l)))}for(var n in e)if(e.hasOwnProperty(n)){var l;if((l=e[n]).active&&!l.split&&-1==l.field.search("time_finish_"))if(-1==l.field.search("place")){if((!i.collapsible||l.primary)&&!l.hide){if((!i.divide_fields&&0==a||a%i.divide_fields==0)&&(o+='<table cellspacing="0" cellpadding="0" border="0" class="info-table fields-primary">',o+="<tbody>"),null==t[l.field]&&(t[l.field]=""),"position_info"==l.type){var d=this.getPersonInfoStrings(t);t[l.field]=d.title}if("diff_time"==l.type){var h=!1;for(var p in t.split_groups)t.split_groups[p].active&&(h=t.split_groups[p]);if(!h)for(p in t.split_groups){h=t.split_groups[p];break}t[l.field]=h.diff_time_string}if("current_group"==l.type){h=!1;for(var p in t.split_groups)t.split_groups[p].active&&(h=t.split_groups[p]);if(!h)for(p in t.split_groups){h=t.split_groups[p];break}t[l.field]=h.title}if("diff_km"==l.type){h=!1;for(var p in t.split_groups)t.split_groups[p].active&&(h=t.split_groups[p]);if(!h)for(p in t.split_groups){h=t.split_groups[p];break}t[l.field]=h.diff_km_string}o+='<tr class="fav-row '+l.type+" "+l.class+'"><td class="desc">'+l.name+'</td><td class="last">'+t[l.field]+"</td></tr>",++a%i.divide_fields!=0&&a!=r||(o+="</tbody>",o+="</table>"),1===s.length&&(t[s[0].field]||(t[s[0].field]="-"),o+='<tr><td class="desc">'+s[0].name+'</td><td class="last">'+t[s[0].field]+"</td></tr>")}}else s.push(l)}return o},renderFavoritesSecondaryFields:function(t,e,i){var s='<table cellspacing="0" cellpadding="0" border="0" class="info-table fields-primary">';s+="<tbody>";for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];a.active&&(a.split||-1==a.field.search("time_finish_")&&-1==a.field.search("place")&&(i.collapsible&&a.primary||a.hide||(null==t[a.field]&&(t[a.field]=""),s+='<tr class="fav-row '+a.type+'"><td class="desc">'+a.name+'</td><td class="last">'+t[a.field]+"</td></tr>",0)))}return s+="</tbody>",s+="</table>"},renderFavoritesSplits:function(t,e,i){var s,o,a,r,n=0,l="";for(var d in t.splits)if(t.splits.hasOwnProperty(d)){if(!i.divide_splits&&0==n||n%i.divide_splits==0){l+='<table cellspacing="0" cellpadding="0" border="0" class="info-table splits">',l+="<thead>",l+="<tr>",s=0;for(a in e)e.hasOwnProperty(a)&&e[a].active&&e[a].split&&s++;r=0;for(a in e)e.hasOwnProperty(a)&&e[a].active&&e[a].split&&(o="",0==r&&(o+=" desc"),r+1==s&&(o+=" last"),e[a].class&&(o+=" "+e[a].class),o&&(o=' class="'+o+'"'),l+="<td"+o+">"+e[a].name+"</td>",r++);l+="</tr>",l+="</thead>",l+="<tbody>"}l+="<tr"+(o=t.splits[d].estimated?' class="estimated"':"")+" onmouseover=\"jQuery(this).addClass('mark');\" onmouseout=\"jQuery(this).removeClass('mark');\">",r=0;for(a in e)e.hasOwnProperty(a)&&e[a].active&&e[a].split&&(o="",0==r&&(o+=" desc"),r+1==s&&(o+=" last"),e[a].class&&(o+=" "+e[a].class),o&&(o=' class="'+o+'"'),l+="<td"+o+">"+t.splits[d][e[a].field]+"</td>",r++);l+="</tr>",++n%i.divide_splits!=0&&n!=t.splits.length||(l+="</tbody>",l+="</table>")}return l},renderFavoritesPlaces:function(t,e,i){var s,o="",a='<table cellspacing="0" cellpadding="0" border="0" class="info-table places">';a+="<thead>",a+="<tr>",a+='<td class="desc">'+this.strings.places+"</td>";for(s in e)e.hasOwnProperty(s)&&(a+='<td class="last">'+e[s].name+"</td>");a+="</tr>",a+="</thead>",a+="<tbody>",a+="<tr>",a+='<td class="desc"></td>';for(s in e)e.hasOwnProperty(s)&&(o="",o=null==t[e[s].field]?"-":t[e[s].field],a+='<td class="'+(s==e.length-1?"last":"")+'">'+o+"</td>");return a+="</tr>",a+="</tbody>",a+="</table>"},renderFavoritesHead:function(t,e,i,s){var o="";o=this.data.global.options.favorite_titles[i]?this.data.global.options.favorite_titles[i]:"";var a,r="",n="";for(a in e)e.hasOwnProperty(a)&&e[a].active&&e[a].head&&(e[a].name&&(n=e[a].name+": "),r+='  <span class="field-'+e[a].field+'">'+n+t[e[a].field]+"</span>");var l='<div class="info-head">';return l+='  <div class="color last fav-color i-'+i+'">'+o+"</div>",l+=r,l+='  <div class="fav-options "><span class="icon s favorite-toggle"><img onclick="'+this.options.globalObjectName+".trigger('removeFavorite', {id:'"+t.id+'\'});" src="'+this.options.path_icons+'/icons/delete.svg" alt="'+this.strings.remove+'" title="'+this.strings.remove+'" /></span></div>',l+="</div>"},openFavoriteDetails:function(t,e){var i=jQuery("#f-"+t+" .info-secondary");i.css({display:"block"});var s=i.position(),o=i.offset(),a=s.top+(e.top-o.top),r=s.left+(e.left-o.left);i.css({display:"block",left:r+"px",top:a+"px"}),i.draggable({snap:!0,cursor:"move",start:function(){jQuery("#f-"+t).addClass("dragged")}})},closeFavoriteDetails:function(t,e){jQuery("#f-"+t+" .info-secondary").css({display:"none"}),jQuery("#f-"+t).removeClass("dragged")},renderContainerContentTypeMap:function(t){var e="";if(e+='<div class="status buttons map hideable">',this.data.global.options.show_search&&(e+=' <div class="leaderboard-search"><span class="caption">'+this.strings.add_favorite+'</span> <input type="text" id="autocomplete" name="autocomplete_parameter" onfocus="this.value=\'\';this.style.color=\'#333333\';" onblur="this.style.color=\'#AAAAAA\'; this.value=\''+this.strings.search_help+'\'" value="'+this.strings.search_help+'" /> <div class="message not_found tooltip">'+this.strings.not_found+"</div></div>"),e+=' <a title="'+this.strings.help_center+'" class="tt-help button-map-center" href="#" onclick="'+this.options.globalObjectName+".trigger('centerMap', {container:'"+t+"'}); return false;\">"+this.strings.map_center+"</a>",e+=' <a title="'+this.strings.help_autozoom+'" class="tt-help button-map-autozoom has-status" href="#" onclick="'+this.options.globalObjectName+".trigger('switchAutoZoom', {container:'"+t+"'}); return false;\">"+this.strings.autozoom+"</a>",this.getContainerByType("overlays")){this.data.global.options.tooltip_intros.map_overlays?e+=' <a title="'+this.strings.help_map_overlays+'" class="tt-help tt-oninit tt-pos-bottom button-map-overlays" href="#" >'+this.strings.map_overlays+"</a>":e+=' <a title="'+this.strings.help_map_overlays+'" class="tt-help tt-pos-bottom button-map-overlays" href="#" >'+this.strings.map_overlays+"</a>";var i=this.options.globalObjectName;this.eventsDelete.click.push({selector:".button-map-overlays"}),this.events.click.push({selector:".button-map-overlays",func:function(t){return window[i].trigger("switchOverlayMenu",{top:t.pageY,left:t.pageX}),!1}})}if(e+="</div>",e+='<div id="map-container-'+t+'" class="map-container" style="height:'+this.data.global.options.map_height+'px"></div>',this.data.global.options.replay_mode){if(e+='<div class="replay-controls">',e+='<div class="replay-buttons">',e+='  <span class="button" onclick="'+this.options.globalObjectName+".trigger('replayPlay');\"><img src=\""+this.options.path_images+'/icon_play.png" alt="" title=""/>'+this.strings.replay_play+"</span>",e+='  <span class="button" onclick="'+this.options.globalObjectName+".trigger('replayStop');\"><img  src=\""+this.options.path_images+'/icon_stop.png" alt="" title=""/>'+this.strings.replay_stop+"</span>",e+='  <span class="button" onclick="'+this.options.globalObjectName+".trigger('replayRewind');\"><img  src=\""+this.options.path_images+'/icon_rewind.png" alt="" title=""/>'+this.strings.replay_rewind+"</span>",e+="</div>",e+='<div class="slider-time">',e+='  <span class="label start">'+this.strings.slider_start+"</span>",e+='  <span class="label finish">'+this.strings.slider_finish+"</span>",this.data.global.options.tooltip_intros.map_slider)var s="tt-oninit";this.data.global.options.replay_daytime?e+='  <span title="'+this.strings.help_map_slider+'" class="tt-help '+s+' tt-pos-top label time">'+this.strings.replay_daytime+' <span id="replay-racetime">00:00:00</span></span>':e+='  <span title="'+this.strings.help_map_slider+'" class="tt-help '+s+' tt-pos-top label time">'+this.strings.replay_racetime+' <span id="replay-racetime">00:00:00</span></span>',e+='  <span class="slider"></span>',e+="</div>",e+='<div class="slider-speed">',e+='  <span class="label">'+this.strings.replay_speed+' <span class="replay-speed"></span></span>',e+='  <span class="slider"></span>',e+="</div>",e+='<div style="clear:both;"></div>',e+="</div>"}return e+=this.renderOverlayMenu(),e+='<div style="display:none" class="mapInfoWindow"></div>'},renderOverlayMenu:function(){var t=this.getContainerByType("overlays"),e="",i="",s=this.options.globalObjectName;if(t){e+='<div style="display:none" class="overlayMenu">',e+='<div class="menu-divider">Selected Overlays</div>';for(var o in t.data.rows)if(t.data.rows.hasOwnProperty(o)){var a=t.data.rows[o],r=this.mapFetchIcons(a.icons,"resultsboard");i=r.icon_settings?'<img src="'+r.icon_settings.url+'" alt=""/>':"",-1!=this.mapOverlays.indexOf(a.id)?e+='<a class="active" id="overlayButton-'+a.id+'" href="#">'+i+a.title+"</a>":e+='<a id="overlayButton-'+a.id+'" href="#">'+i+a.title+"</a>",this.eventsDelete.click.push({selector:"#overlayButton-"+a.id}),this.events.click.push({selector:"#overlayButton-"+a.id,data:{overlayId:a.id},func:function(t){return window[s].trigger("switchOverlay",{overlayId:t.data.overlayId,top:t.pageY,left:t.pageX}),!1}})}e+="</div>"}return e},switchFullscreen:function(){var t;if("fixed"!=jQuery(".cbox.left .list").css("position")){this.fullscreen_old_style={height:jQuery(".cbox.left .list").css("height"),position:"relative",width:jQuery(".cbox.left .list").css("width"),overflow:"inherit"};for(t in this.data.containers)if(this.data.containers.hasOwnProperty(t)&&"map"==this.data.containers[t].type){this.fullscreen_map_old_style={height:jQuery("#map-container-"+this.data.containers[t].id).css("height")};break}jQuery(".cbox.left .list").css({position:"fixed",overflow:"hidden",zIndex:9999,margin:0,top:0,left:0,width:jQuery(window).width()+"px",height:jQuery(window).height()+"px"}),jQuery(".cbox.left .list").addClass("is-fullscreen"),this.render();for(t in this.data.containers)if(this.data.containers.hasOwnProperty(t)&&"map"==this.data.containers[t].type){jQuery(".tt-help").tooltip("disable"),jQuery("#map-container-"+this.data.containers[t].id).css("height",jQuery(window).height()-142+"px"),this.mapInit(this.data.containers[t].id),this.mapInitSliders(),this.registerTooltips();break}}else{jQuery(".cbox.left .list").css(this.fullscreen_old_style),jQuery(".cbox.left .list").removeClass("is-fullscreen"),this.render();for(t in this.data.containers)if(this.data.containers.hasOwnProperty(t)&&"map"==this.data.containers[t].type){jQuery(".tt-help").tooltip("disable"),jQuery("#map-container-"+this.data.containers[t].id).css(this.fullscreen_map_old_style),this.mapInit(this.data.containers[t].id),this.mapInitSliders(),this.registerTooltips();break}}},getReplaySpeedFromIndex:function(t){return this.data.global.options.replay_speeds[t]},getContainerByType:function(t){for(i=0;i<this.data.containers.length;i++)if(this.data.containers[i].type==t)return this.data.containers[i];return!1},getPersonInfoStrings:function(t,e,i,s){var o="",a="",r="",n="marker-person",l=t.split_groups[t.global_info.active_group_key];return 99999!=t.start_no&&"F99999"!=t.start_no&&99998!=t.start_no&&"F99998"!=t.start_no||(t.start_no="",t.start_no_text=""),isNaN(l.estimated_pos)?"finished"==l.estimated_pos?(o=this.strings.finished,a+="<b>"+t.start_no_text+"</b> "+t.__fullname+"<br/>("+this.strings.finished+")"):"started"==l.estimated_pos||"started"==l.state?(o=this.strings.started,a+="<b>"+t.start_no_text+"</b> "+t.__fullname+"<br/>("+this.strings.started+")"):(o=this.strings.not_started,a+="<b>"+t.start_no_text+"</b> "+t.__fullname):(l.estimated_pos_string||(l.estimated_pos_string=l.estimated_pos),a+="<b>"+t.start_no_text+"</b> "+t.__fullname,a+="<br/>"+l.estimated_pos_string+" km",o+=l.estimated_pos_string+" km",this.data.global.options.show_map_miles&&(a+="/"+t.__estimated_pos_factor+" Miles",o+="/"+t.__estimated_pos_factor+" Miles"),t.__estimated_finish&&(a+="<br/>"+this.strings.estimated_finish+": "+t.__estimated_finish),t.__estimated_finish_daytime&&(a+="<br/>"+this.strings.estimated_finish_daytime+": "+t.__estimated_finish_daytime)),r+=a,a='<img class="star" src="'+this.options.path_images+'/icon_star.png" alt="" />'+a,e?o+=" "+this.strings.click_to_follow:i?(a='<img class="star" src="'+this.options.path_images+'/icon_star.png" alt="" />',a+='<span class="favorite_title">'+this.data.global.options.favorite_titles[s]+"</span>",a+='<span class="label"><b>'+t.start_no_text+"</b> "+t.__fullname,t.subtitle&&(a+="<br/>"+t.subtitle),a+="</span>",n="marker-person small details-short",r=this.data.global.options.favorite_titles[s]):(a='<img class="star" src="'+this.options.path_images+'/icon_star.png" alt="" />',a+='<span class="favorite_title">'+this.data.global.options.favorite_titles[s]+"</span>",n="marker-person small",r=this.data.global.options.favorite_titles[s]),n+=" fav-color i-"+s,{title:o,label:a,summary:r,css_class:n}},mapInit:function(t){if("object"==typeof google.maps||"function"==typeof google.maps){this.maps[t]=new google.maps.Map(document.getElementById("map-container-"+t));var e;switch(this.data.global.options.map_type){case"satellite":e=google.maps.MapTypeId.SATELLITE;break;case"hybrid":e=google.maps.MapTypeId.HYBRID;break;case"physical":case"terrain":e=google.maps.MapTypeId.TERRAIN;break;default:e=google.maps.MapTypeId.ROADMAP}if(this.maps[t].setOptions({mapTypeId:e,zoom:8}),this.data.containers[t].data.tracks){this.mapPolylines[t]=[],this.mapMarkers[t]=[],this.mapMarkersPersons[t]=[],this.mapMarkersFree[t]=[],this.mapBounds[t]=new google.maps.LatLngBounds;var i=0;for(var s in this.data.containers[t].data.tracks)if(this.data.containers[t].data.tracks.hasOwnProperty(s)){var o=!1;i==this.data.containers[t].data.tracks.length-1&&(o=!0),this.mapPolylines[t][s]=this.mapInitTrack(t,this.data.containers[t].data.tracks[s],this.data.containers[t].data.fields.data,o),i++,this.maps[t].fitBounds(this.mapBounds[t])}}}this.mapUpdate(t),this.mapUpdateOverlays(t)},mapInitTrack:function(t,e,i,s){var o="#0000ff";e.color&&(o=e.color);var a=new google.maps.Polyline({strokeColor:o,strokeWeight:4,strokeOpacity:.8}),r=google.maps.geometry.encoding.decodePath(e.points_encoded);a.setPath(r),a.setMap(this.maps[t]);for(var n=0;n<r.length;n++)this.mapBounds[t].extend(r[n]);return this.mapInitTrackMarkers(t,e,a,i,s),a},mapInitTrackMarkers:function(t,e,i,s,o){var a={},r="";if(e.split_marker&&s.length)for(var n in s)if(s.hasOwnProperty(n)){var l=s[n];if(-1==l.field.search("time_finish_")&&void 0!==l.km){(c=moveAlongPath(i,1e3*l.km))&&new MarkerWithLabel({icon:a=new google.maps.MarkerImage(this.options.path_images+"/map_marker_grey.png",new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37)),position:c,draggable:!1,map:this.maps[t],labelContent:l.name,labelAnchor:new google.maps.Point(10,31),labelClass:"marker-km",labelStyle:{opacity:1}})}}if(e.km_marker)for(var d=1e3*e.km_marker,h=888;;){if(!(c=moveAlongPath(i,d)))break;new MarkerWithLabel({icon:a=new google.maps.MarkerImage(this.options.path_images+"/map_marker_grey.png",new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37)),position:c,draggable:!1,map:this.maps[t],labelContent:d/1e3+"<br/>km",labelAnchor:new google.maps.Point(8,31),labelClass:"marker-km",zIndex:h,labelZIndex:h+1}),h++,d+=1e3*e.km_marker}if(e.custom_marker)for(var p in e.custom_marker)if(e.custom_marker.hasOwnProperty(p)){var c,u=e.custom_marker[p];(c=moveAlongPath(i,1e3*u.km))&&new MarkerWithLabel({icon:a=new google.maps.MarkerImage(this.options.path_images+"/map_marker_grey.png",new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37)),position:c,draggable:!1,map:this.maps[t],labelContent:u.title,labelAnchor:new google.maps.Point(10,31),labelClass:"marker-km custom",labelStyle:{opacity:1}})}var g=i.getPath().getAt(i.getPath().getLength()-1);g&&(r=o?this.options.path_images+"/map_flag_finish.png":this.options.path_images+"/map_flag_blue.png",a=new google.maps.MarkerImage(r,new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(11,30)),new google.maps.Marker({position:g,map:this.maps[t],icon:a}));var f=i.getPath().getAt(0);f&&(a=new google.maps.MarkerImage(this.options.path_images+"/map_flag_start.png",new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(11,30)),new google.maps.Marker({position:f,map:this.maps[t],icon:a}))},mapUpdate:function(t){var e=this.getContainerByType("favorites");if(!e)return!1;for(var i in e.data.rows)if(e.data.rows.hasOwnProperty(i)){var s=e.data.rows[i];if(!s.id)return!0;var o=s.split_groups[s.global_info.active_group_key];if(void 0===this.mapMarkerCluster[t]&&(this.mapMarkerCluster[t]={}),o.estimated_pos||0===o.estimated_pos){var a,r="";if(jQuery.each(this.data.containers[t].data.mappings.tracks,function(t,e){if(e.event_ids&&-1==e.event_ids.indexOf(s.event))return!0;if(s.start_group&&e.start_groups&&-1==e.start_groups.indexOf(s.start_group))return!0;if(e.split_groups&&-1==e.split_groups.indexOf(s.global_info.active_group_key))return!0;if(e.field_values)for(var i in e.field_values)if(e.field_values.hasOwnProperty(i)&&-1==e.field_values[i].indexOf(s[i]))return!0;return r=e.track,!1}),!r)continue;void 0!==(a=this.mapPolylines[t][r])&&this.mapUpdatePersonMarker(t,r,a,s,i)}}if(this.data.containers[t].data.options.clustering)for(r in this.data.containers[t].data.tracks)if(this.data.containers[t].data.tracks.hasOwnProperty(r))if(this.mapMarkerCluster[t]||(this.mapMarkerCluster[t]={}),this.mapMarkerCluster[t]&&void 0===this.mapMarkerCluster[t][r]&&(this.mapMarkerCluster[t][r]={}),this.mapMarkerCluster[t]&&"function"==typeof this.mapMarkerCluster[t][r].repaint)this.mapMarkerCluster[t][r].repaint();else{this.mapMarkerClusterIcons[t]=[];for(var n in this.data.containers[t].data.mappings.markers){var l=this.data.containers[t].data.mappings.markers[n];if(l.cluster_sizes){var d=this.data.containers[t].data.markers[l.marker];d.icon.anchor||(d.icon.anchor=[32,32]),d.icon.height||(d.icon.height=32),d.icon.width||(d.icon.width=32),d.icon.url&&this.mapMarkerClusterIcons[t].push({url:d.icon.url,height:d.icon.height,width:d.icon.width,anchor:[20,20],anchorIcon:[d.icon.anchor[0],d.icon.anchor[1]],mapping:l})}}var h=this.mapMarkerClusterIcons[t];this.mapMarkerCluster[t][r]=new MarkerClusterer(this.maps[t],this.mapMarkersPersons[t],{gridSize:20,calculator:function(t,e){var i=0,s="",o=0,a=0,r=0;for(var n in t)t.hasOwnProperty(n)&&("e"==t[n].clusterSummaryDirection&&o++,"w"==t[n].clusterSummaryDirection&&a++,"not_started"!=t[n].clusterSummaryPosition&&"finished"!=t[n].clusterSummaryPosition||r++,t[n].clusterSummary&&(s+="<span"+(t[n].clusterSummaryClass?' class="'+t[n].clusterSummaryClass+'"':"")+">"+t[n].clusterSummary+"</span>"));var l={count:t.length};l.count>4&&(l.count=4),r==t.length?l.state="not_started":(l.state="started",l.direction=o>a?"e":"w");for(var d in h){var p=h[d].mapping;if((!p.cluster_sizes||-1!=p.cluster_sizes.indexOf(l.count))&&!(p.directions&&-1==p.directions.indexOf(l.direction)||p.states&&-1==p.states.indexOf(l.state))){i=parseInt(d)+1;break}}var c='<div class="cluster-summary">'+s+"</div>";return{text:l.count,index:i,title:"",html:c}},styles:this.mapMarkerClusterIcons[t]})}if(this.favoritesSelected){var p=new google.maps.LatLngBounds,c=0;for(var n in this.mapMarkersPersons[t])this.mapMarkersPersons[t].hasOwnProperty(n)&&-1!=this.favoritesSelected.indexOf(this.mapMarkersPersons[t][n].favoriteId)&&(c++,p.extend(this.mapMarkersPersons[t][n].getPosition()));this.mapAutoZoom&&c>1?(this.maps[t].fitBounds(p),this.data.containers[t].data.options.autozoom_add&&this.maps[t].setZoom(this.maps[t].getZoom()+this.data.containers[t].data.options.autozoom_add)):this.mapAutoZoom&&1==c?(this.maps[t].setCenter(p.getCenter()),this.maps[t].setZoom(15)):c&&this.maps[t].setCenter(p.getCenter())}},getDevicePixelRatio:function(){var t=1;return void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?t=window.screen.systemXDPI/window.screen.logicalXDPI:void 0!==window.devicePixelRatio&&(t=window.devicePixelRatio),t},mapFetchIcons:function(t,e){var i={},s="",o="",a="",r="";for(var n in t)t.hasOwnProperty(n)&&n.substr(0,e.length)==e&&((i=this.mapFetchIcon(e,n,"marker")).icon&&(s=t[n],o=i.ratio),(i=this.mapFetchIcon(e,n,"settings")).icon&&(a=t[n],r=i.ratio));for(var n in t)t.hasOwnProperty(n)&&(s||(i=this.mapFetchIcon("",n,"marker")).icon&&(s=t[n],o=i.ratio),a||(i=this.mapFetchIcon("",n,"settings")).icon&&(a=t[n],r=i.ratio));return{icon_settings:a,icon_settings_ratio:r,icon_marker:s,icon_marker_ratio:o}},mapFetchIcon:function(t,e,i){var s="",o=null;return t&&(shift_substr=t.length+1),e.substr(0,i.length+3)==i+"@3x"&&3==this.pixelRatio?(s=e,o=3):"@2x"==e.substr(0,i.length+3)&&2==this.pixelRatio?(s=e,o=2):e.substr(0,i.length)==i&&(s=e,o=1),{icon:s,ratio:o}},mapUpdateOverlays:function(t){var e=this.getContainerByType("overlays");if(e)for(var i in e.data.rows)if(e.data.rows.hasOwnProperty(i)){var s=e.data.rows[i];if(-1!=this.mapOverlays.indexOf(s.id)){if(s.icons)var o=this.mapFetchIcons(s.icons,"resultsboard");for(var a in s.points)if(s.points.hasOwnProperty(a)){var r=this.mapFetchIcons(s.points[a].icons,"resultsboard"),n={};n=r.icon_marker?r.icon_marker:o.icon_marker,this.mapUpdateMarker(t,{icon:n,position_latlng:s.points[a].position_latlng,title:s.points[a].title,description:s.points[a].description,show_label:s.show_label,detail_window:s.show_label},s.id,a)}}else{for(a in this.mapMarkers[t][s.id])this.mapMarkers[t][s.id].hasOwnProperty(a)&&this.mapMarkers[t][s.id][a].setMap(null);this.mapMarkers[t][s.id]=[]}}},mapUpdateMarker:function(t,e,i,s){var o={},a=["icon","shadow"];for(var r in a)if(a.hasOwnProperty(r)){var n=a[r];e[n]&&(o[n]=new google.maps.MarkerImage,e[n].url&&(o[n].url=e[n].url),e[n].width&&e[n].height&&(o[n].size=new google.maps.Size(e[n].width,e[n].height)),e[n].anchor&&(o[n].anchor=new google.maps.Point(e[n].anchor[0],e[n].anchor[1])),e[n].origin&&(o[n].origin=new google.maps.Point(e[n].origin[0],e[n].origin[1])))}o.icon||(o.icon=new google.maps.MarkerImage,o.icon.url="http://maps.gstatic.com/intl/de_ALL/mapfiles/ms/micons/man.png",o.icon.anchor=new google.maps.Point(16,32)),o.shadow||(o.shadow=new google.maps.MarkerImage,o.shadow.url="http://maps.gstatic.com/intl/de_ALL/mapfiles/ms/micons/man.shadow.png",o.shadow.anchor=new google.maps.Point(16,32)),void 0===this.mapMarkers[t][i]&&(this.mapMarkers[t][i]={});var l=new google.maps.LatLng(e.position_latlng[0],e.position_latlng[1]);if(this.mapMarkers[t][i][s])this.mapMarkers[t][i][s].setPosition(l),this.mapMarkers[t][i][s].setOptions({labelContent:e.title,optimized:!1}),this.mapMarkers[t][i][s].setIcon(o.icon),this.mapMarkers[t][i][s].setShadow(o.shadow);else{e.show_label?(this.mapMarkers[t][i][s]={},this.mapMarkers[t][i][s]=new MarkerWithLabel({icon:o.icon,shadow:o.shadow,optimized:!1,position:l,draggable:!1,labelContent:e.title,labelAnchor:new google.maps.Point(-10,20),labelClass:"marker-person marker-group marker-group-"+i})):(this.mapMarkers[t][i][s]={},this.mapMarkers[t][i][s]=new google.maps.Marker({icon:o.icon,shadow:o.shadow,optimized:!1,position:l,draggable:!1})),this.mapMarkers[t][i][s].setMap(this.maps[t]);var d=this.options.globalObjectName,h=new google.maps.OverlayView;h.draw=function(){},h.setMap(this.maps[t]),google.maps.event.addListener(this.mapMarkers[t][i][s],"mouseover",function(t){var o="<h3>"+e.title+"</h3>";o+='<div class="description">'+e.description+"</div>";var a=h.getProjection().fromLatLngToContainerPixel(t.latLng);window[d].trigger("openInfoWindow",{index:s,groupKey:i,top:a.y,left:a.x,html:o})}),google.maps.event.addListener(this.mapMarkers[t][i][s],"mouseout",function(t){window[d].trigger("closeInfoWindow",{})})}return!0},mapUpdatePersonMarker:function(t,e,i,s,o){var a="",r=!1,n=s.split_groups[s.global_info.active_group_key];if(i){var l=0;isNaN(n.estimated_pos)?"finished"==n.estimated_pos?r=i.getPath().getAt(i.getPath().getLength()-1):"started"==n.estimated_pos?r=moveAlongPath(i,0):"not_started"==n.estimated_pos&&(r=i.getPath().getAt(0)):(r=moveAlongPath(i,1e3*n.estimated_pos),l=n.estimated_pos)}if(!r)return!1;for(var d in this.data.containers[t].data.mappings.markers)if(this.data.containers[t].data.mappings.markers.hasOwnProperty(d)){var h=this.data.containers[t].data.mappings.markers[d];if(!(h.event_ids&&-1==h.event_ids.indexOf(s.event)||h.directions&&-1==h.directions.indexOf(r.direction)||h.sex&&-1==h.sex.indexOf(s.sex)||h.states&&-1==h.states.indexOf(n.state)||h.split_groups&&-1==h.split_groups.indexOf(s.global_info.active_group_key)||h.source&&-1==h.source.indexOf(s.position_data.source))){if(l>0&&h.force_marker_id&&this.data.containers[t].data.tracks[e].force_tracking_marker){var p=this.data.containers[t].data.tracks[e].force_tracking_marker,c=!1;for(var u in p)p.hasOwnProperty(u)&&p[u].from_km<l&&(c=p[u].marker_id);if(-1==h.force_marker_id.indexOf(c))continue}a=h.marker;break}}var g={};if(a&&this.data.containers[t].data.markers[a]){var f=this.data.containers[t].data.markers[a],m=["icon","shadow"];for(var _ in m)if(m.hasOwnProperty(_)){var v=m[_];f[v]&&(g[v]=new google.maps.MarkerImage,f[v].url&&(g[v].url=f[v].url),f[v].width&&f[v].height&&(g[v].size=new google.maps.Size(f[v].width,f[v].height)),f[v].anchor&&(g[v].anchor=new google.maps.Point(f[v].anchor[0],f[v].anchor[1])),f[v].origin&&(g[v].origin=new google.maps.Point(f[v].origin[0],f[v].origin[1])))}}g.icon||(g.icon=new google.maps.MarkerImage,g.icon.url="http://maps.gstatic.com/intl/de_ALL/mapfiles/ms/micons/man.png",g.icon.anchor=new google.maps.Point(16,32)),g.shadow||(g.shadow=new google.maps.MarkerImage,g.shadow.url="http://maps.gstatic.com/intl/de_ALL/mapfiles/ms/micons/man.shadow.png",g.shadow.anchor=new google.maps.Point(16,32));var y=this.getPersonInfoStrings(s,this.data.containers[t].data.options.show_person_details,this.data.containers[t].data.options.show_person_details_short,o);if(this.mapMarkersPersons[t][s.id])this.mapMarkersPersons[t][s.id].setPosition(r),this.mapMarkersPersons[t][s.id].setOptions({clusterSummary:y.summary,clusterSummaryClass:y.css_class+" summary",clusterSummaryDirection:r.direction,clusterSummaryPosition:n.estimated_pos,labelContent:y.label,optimized:!1}),this.mapMarkersPersons[t][s.id].setIcon(g.icon),this.mapMarkersPersons[t][s.id].setShadow(g.shadow);else{this.mapMarkersPersons[t][s.id]={},this.mapMarkersPersons[t][s.id]=new MarkerWithLabel({dataId:s.id,icon:g.icon,shadow:g.shadow,favoriteId:s.id,optimized:!1,position:r,draggable:!1,clusterSummary:y.summary,clusterSummaryClass:y.css_class+" summary",clusterSummaryDirection:r.direction,clusterSummaryPosition:n.estimated_pos,labelContent:y.label,labelAnchor:new google.maps.Point(-20,30),zIndex:999,labelZIndex:1e3,labelClass:y.css_class}),this.data.containers[t].data.options.clustering?this.mapMarkerCluster[t][e]&&"function"==typeof this.mapMarkerCluster[t][e].repaint&&(this.mapMarkerCluster[t][e]={}):this.mapMarkersPersons[t][s.id].setMap(this.maps[t]);var b=this.options.globalObjectName;google.maps.event.addListener(this.mapMarkersPersons[t][s.id],"click",function(){window[b].trigger("selectFavoriteToggle",{id:this.favoriteId}),-1!=window[b].favoritesSelected.indexOf(this.favoriteId)?(this.setOptions({labelClass:y.css_class+" selected"}),this.setZIndex(9999)):(this.setOptions({labelClass:y.css_class}),this.setZIndex(void 0))})}if(s.tracker_data&&s.tracker_data.position_lonlat.length){var k=new google.maps.LatLng(s.tracker_data.position_lonlat[1],s.tracker_data.position_lonlat[0]),w="<b>"+s.tracker_data.node_id+"</b>";w+="<br/>"+s.tracker_data.position[0]+","+s.tracker_data.position[1],this.mapMarkersPersons[t][s.id]?(this.mapMarkersPersons[t][s.id].setPosition(k),this.mapMarkersPersons[t][s.id].setOptions({clusterSummary:y.summary,clusterSummaryClass:y.css_class+" summary",clusterSummaryDirection:r.direction,clusterSummaryPosition:n.estimated_pos,labelContent:w,optimized:!1}),this.mapMarkersPersons[t][s.id].setIcon(g.icon),this.mapMarkersPersons[t][s.id].setShadow(g.shadow)):(this.mapMarkersPersons[t][s.id]={},this.mapMarkersPersons[t][s.id]=new MarkerWithLabel({dataId:s.id,icon:g.icon,shadow:g.shadow,favoriteId:s.id,optimized:!1,position:r,draggable:!1,clusterSummary:y.summary,clusterSummaryClass:y.css_class+" summary",clusterSummaryDirection:r.direction,clusterSummaryPosition:n.estimated_pos,labelContent:w,labelAnchor:new google.maps.Point(-20,30),labelClass:y.css_class,zIndex:999,labelZIndex:1e3}))}return!0},mapCenter:function(t){var e=new google.maps.LatLngBounds;for(var i in this.mapPolylines[t])if(this.mapPolylines[t].hasOwnProperty(i))for(var s=this.mapPolylines[t][i].getPath(),o=0;o<s.getLength();o++)e.extend(s.getAt(o));this.maps[t].fitBounds(e)},mapInitSliders:function(){this.replay_time||(this.replay_time=this.replay_time_max+60,jQuery(".replay-racetime").html(window[this.options.globalObjectName].ms2time(this.replay_time)));var t=this.options.globalObjectName;this.slider_time=jQuery(".slider-time .slider").slider({value:this.replay_time,min:0,max:this.replay_time_max+6e4,step:this.data.global.options.replay_slider_step,animate:!0,slide:function(e,i){window[t].replay_time=i.value,window[t].refresh()}});var e=2;this.replay_speed||(this.replay_speed=2,jQuery(".replay-speed").html(this.replay_speed+"x"));for(var i in this.data.global.options.replay_speeds)if(this.data.global.options.replay_speeds.hasOwnProperty(i)&&this.data.global.options.replay_speeds[i]==this.replay_speed){e=i;break}this.slider_speed=jQuery(".slider-speed .slider").slider({value:e,min:0,max:6,step:1,animate:!0,slide:function(e,i){window[t].replay_speed=window[t].getReplaySpeedFromIndex(i.value),jQuery(".replay-speed").html(window[t].getReplaySpeedFromIndex(i.value)+"x")}})}},"function"==typeof jQuery&&jQuery.noConflict(),"object"==typeof google&&(ClusterIcon.prototype.onAdd=function(){var t,e,i=this;this.div_=document.createElement("div"),this.div_.className=this.className_,this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){e=t}),google.maps.event.addDomListener(this.div_,"mousedown",function(){t=!0,e=!1}),google.maps.event.addDomListener(this.div_,"click",function(s){if(t=!1,!e){var o,a,r=i.cluster_.getMarkerClusterer();google.maps.event.trigger(r,"click",i.cluster_),google.maps.event.trigger(r,"clusterclick",i.cluster_),r.getZoomOnClick()&&(a=r.getMaxZoom(),o=i.cluster_.getBounds(),r.getMap().fitBounds(o),setTimeout(function(){r.getMap().fitBounds(o),null!==a&&r.getMap().getZoom()>a&&r.getMap().setZoom(a+1)},100)),s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){var t=i.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"mouseover",i.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){var t=i.cluster_.getMarkerClusterer();google.maps.event.trigger(t,"mouseout",i.cluster_)})},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.draw=function(){if(this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var t="",e=this.backgroundPosition_.split(" "),i=parseInt(e[0].trim(),10),s=parseInt(e[1].trim(),10),o=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(o),t="<img src='"+this.url_+"' style='position: absolute; top: "+s+"px; left: "+i+"px; ",this.cluster_.getMarkerClusterer().enableRetinaIcons_||(t+="clip: rect("+-1*s+"px, "+(-1*i+this.width_)+"px, "+(-1*s+this.height_)+"px, "+-1*i+"px);"),t+="'>",this.sums_.html?this.div_.innerHTML=t+this.sums_.html:this.div_.innerHTML=t+"<div style='position: absolute;top: "+this.anchorText_[0]+"px;left: "+this.anchorText_[1]+"px;color: "+this.textColor_+";font-size: "+this.textSize_+"px;font-family: "+this.fontFamily_+";font-weight: "+this.fontWeight_+";font-style: "+this.fontStyle_+";text-decoration: "+this.textDecoration_+";text-align: center;width: "+this.width_+"px;line-height:"+this.height_+"px;'>"+this.sums_.text+"</div>",void 0===this.sums_.title||""===this.sums_.title?this.div_.title=this.cluster_.getMarkerClusterer().getTitle():this.div_.title=this.sums_.title,this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.useStyle=function(t){this.sums_=t;var e=Math.max(0,t.index-1);e=Math.min(this.styles_.length-1,e);var i=this.styles_[e];this.url_=i.url,this.height_=i.height,this.width_=i.width,this.anchorText_=i.anchorText||[0,0],this.anchorIcon_=i.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)],this.textColor_=i.textColor||"black",this.textSize_=i.textSize||11,this.textDecoration_=i.textDecoration||"none",this.fontWeight_=i.fontWeight||"bold",this.fontStyle_=i.fontStyle||"normal",this.fontFamily_=i.fontFamily||"Arial,sans-serif",this.backgroundPosition_=i.backgroundPosition||"0 0"},ClusterIcon.prototype.setCenter=function(t){this.center_=t},ClusterIcon.prototype.createCss=function(t){var e=[];return e.push("cursor: pointer;"),e.push("position: absolute; top: "+t.y+"px; left: "+t.x+"px;"),e.push("width: "+this.width_+"px; height: "+this.height_+"px;"),e.join("")},ClusterIcon.prototype.getPosFromLatLng_=function(t){var e=this.getProjection().fromLatLngToDivPixel(t);return e.x-=this.anchorIcon_[1],e.y-=this.anchorIcon_[0],e.x=parseInt(e.x,10),e.y=parseInt(e.y,10),e},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var t,e=new google.maps.LatLngBounds(this.center_,this.center_),i=this.getMarkers();for(t=0;t<i.length;t++)e.extend(i[t].getPosition());return e},Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},Cluster.prototype.addMarker=function(t){var e,i,s;if(this.isMarkerAlreadyAdded_(t))return!1;if(this.center_){if(this.averageCenter_){var o=this.markers_.length+1,a=(this.center_.lat()*(o-1)+t.getPosition().lat())/o,r=(this.center_.lng()*(o-1)+t.getPosition().lng())/o;this.center_=new google.maps.LatLng(a,r),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();if(t.isAdded=!0,this.markers_.push(t),i=this.markers_.length,null!==(s=this.markerClusterer_.getMaxZoom())&&this.map_.getZoom()>s)t.getMap()!==this.map_&&t.setMap(this.map_);else if(i<this.minClusterSize_)t.getMap()!==this.map_&&t.setMap(this.map_);else if(i===this.minClusterSize_)for(e=0;e<i;e++)this.markers_[e].setMap(null);else t.setMap(null);return this.updateIcon_(),!0},Cluster.prototype.isMarkerInClusterBounds=function(t){return this.bounds_.contains(t.getPosition())},Cluster.prototype.calculateBounds_=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)},Cluster.prototype.updateIcon_=function(){var t=this.markers_.length,e=this.markerClusterer_.getMaxZoom();if(null!==e&&this.map_.getZoom()>e)this.clusterIcon_.hide();else if(t<this.minClusterSize_)this.clusterIcon_.hide();else{var i=this.markerClusterer_.getStyles().length,s=this.markerClusterer_.getCalculator()(this.markers_,i);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(s),this.clusterIcon_.show()}},Cluster.prototype.isMarkerAlreadyAdded_=function(t){var e;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(t);for(e=0;e<this.markers_.length;e++)if(t===this.markers_[e])return!0;return!1},MarkerClusterer.prototype.onAdd=function(){var t=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){t.resetViewport_(!1),this.getZoom()!==(this.get("minZoom")||0)&&this.getZoom()!==this.get("maxZoom")||google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){t.redraw_()})]},MarkerClusterer.prototype.onRemove=function(){var t;for(t=0;t<this.markers_.length;t++)this.markers_[t].getMap()!==this.activeMap_&&this.markers_[t].setMap(this.activeMap_);for(t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();for(this.clusters_=[],t=0;t<this.listeners_.length;t++)google.maps.event.removeListener(this.listeners_[t]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){var t,e;if(!(this.styles_.length>0))for(t=0;t<this.imageSizes_.length;t++)e=this.imageSizes_[t],this.styles_.push({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:e,width:e})},MarkerClusterer.prototype.fitMapToMarkers=function(){var t,e=this.getMarkers(),i=new google.maps.LatLngBounds;for(t=0;t<e.length;t++)i.extend(e[t].getPosition());this.getMap().fitBounds(i)},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(t){this.gridSize_=t},MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinimumClusterSize=function(t){this.minClusterSize_=t},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.setMaxZoom=function(t){this.maxZoom_=t},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.setStyles=function(t){this.styles_=t},MarkerClusterer.prototype.getTitle=function(){return this.title_},MarkerClusterer.prototype.setTitle=function(t){this.title_=t},MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.setZoomOnClick=function(t){this.zoomOnClick_=t},MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.setAverageCenter=function(t){this.averageCenter_=t},MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},MarkerClusterer.prototype.setIgnoreHidden=function(t){this.ignoreHidden_=t},MarkerClusterer.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons_},MarkerClusterer.prototype.setEnableRetinaIcons=function(t){this.enableRetinaIcons_=t},MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_},MarkerClusterer.prototype.setImageExtension=function(t){this.imageExtension_=t},MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_},MarkerClusterer.prototype.setImagePath=function(t){this.imagePath_=t},MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_},MarkerClusterer.prototype.setImageSizes=function(t){this.imageSizes_=t},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.setCalculator=function(t){this.calculator_=t},MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},MarkerClusterer.prototype.setBatchSizeIE=function(t){this.batchSizeIE_=t},MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_},MarkerClusterer.prototype.setClusterClass=function(t){this.clusterClass_=t},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.getClusters=function(){return this.clusters_},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.addMarker=function(t,e){this.pushMarkerTo_(t),e||this.redraw_()},MarkerClusterer.prototype.addMarkers=function(t,e){var i;for(i in t)t.hasOwnProperty(i)&&this.pushMarkerTo_(t[i]);e||this.redraw_()},MarkerClusterer.prototype.pushMarkerTo_=function(t){if(t.getDraggable()){var e=this;google.maps.event.addListener(t,"dragend",function(){e.ready_&&(this.isAdded=!1,e.repaint())})}t.isAdded=!1,this.markers_.push(t)},MarkerClusterer.prototype.removeMarker=function(t,e){var i=this.removeMarker_(t);return!e&&i&&this.repaint(),i},MarkerClusterer.prototype.removeMarkers=function(t,e){var i,s,o=!1;for(i=0;i<t.length;i++)s=this.removeMarker_(t[i]),o=o||s;return!e&&o&&this.repaint(),o},MarkerClusterer.prototype.removeMarker_=function(t){var e,i=-1;if(this.markers_.indexOf)i=this.markers_.indexOf(t);else for(e=0;e<this.markers_.length;e++)if(t===this.markers_[e]){i=e;break}return-1!==i&&(t.setMap(null),this.markers_.splice(i,1),!0)},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},MarkerClusterer.prototype.repaint=function(){var t=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){var e;for(e=0;e<t.length;e++)t[e].remove()},0)},MarkerClusterer.prototype.getExtendedBounds=function(t){var e=this.getProjection(),i=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),o=e.fromLatLngToDivPixel(i);o.x+=this.gridSize_,o.y-=this.gridSize_;var a=e.fromLatLngToDivPixel(s);a.x-=this.gridSize_,a.y+=this.gridSize_;var r=e.fromDivPixelToLatLng(o),n=e.fromDivPixelToLatLng(a);return t.extend(r),t.extend(n),t},MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)},MarkerClusterer.prototype.resetViewport_=function(t){var e,i;for(e=0;e<this.clusters_.length;e++)this.clusters_[e].remove();for(this.clusters_=[],e=0;e<this.markers_.length;e++)(i=this.markers_[e]).isAdded=!1,t&&i.setMap(null)},MarkerClusterer.prototype.distanceBetweenPoints_=function(t,e){var i=(e.lat()-t.lat())*Math.PI/180,s=(e.lng()-t.lng())*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},MarkerClusterer.prototype.isMarkerInBounds_=function(t,e){return e.contains(t.getPosition())},MarkerClusterer.prototype.addToClosestCluster_=function(t){var e,i,s,o,a=4e4,r=null;for(e=0;e<this.clusters_.length;e++)(o=(s=this.clusters_[e]).getCenter())&&(i=this.distanceBetweenPoints_(o,t.getPosition()))<a&&(a=i,r=s);r&&r.isMarkerInClusterBounds(t)?r.addMarker(t):((s=new Cluster(this)).addMarker(t),this.clusters_.push(s))},MarkerClusterer.prototype.createClusters_=function(t){var e,i,s,o=this;if(this.ready_){0===t&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),s=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));var a=this.getExtendedBounds(s),r=Math.min(t+this.batchSize_,this.markers_.length);for(e=t;e<r;e++)!(i=this.markers_[e]).isAdded&&this.isMarkerInBounds_(i,a)&&(!this.ignoreHidden_||this.ignoreHidden_&&i.getVisible())&&this.addToClosestCluster_(i);r<this.markers_.length?this.timerRefStatic=setTimeout(function(){o.createClusters_(r)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}},MarkerClusterer.prototype.extend=function(t,e){return function(t){var e;for(e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},MarkerClusterer.CALCULATOR=function(t,e){for(var i=0,s=t.length.toString(),o=s;0!==o;)o=parseInt(o/10,10),i++;return i=Math.min(i,e),{text:s,index:i,title:""}},MarkerClusterer.BATCH_SIZE=2e3,MarkerClusterer.BATCH_SIZE_IE=500,MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m",MarkerClusterer.IMAGE_EXTENSION="png",MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90],"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})),Array.indexOf||(Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1}),function(t){t.extend({playSoundInit:function(e){t("body").append('<span id="playSound"></span>');for(var i in e)if("active"!=i){var s=document.createElement("audio");s.id="sound"+i.replace("url_",""),s.autoplay=!1,s.loop=!1,s.volume=1,s.preload="auto",document.getElementById("playSound").appendChild(s);var o=document.createElement("source");o.src=e[i],o.type="audio/wav",s.appendChild(o)}},playSound:function(t){document.getElementById("sound"+t)&&document.getElementById("sound"+t).play()}})}(jQuery),"function"!=typeof openQuicksearch){var openQuicksearch,waitForRequireJsAndInjectQuicksearchFunction=function(){"function"==typeof require?require(["Mika/Quicksearch","Mika/Tools"],function(t,e){jQuery(document).ready(function(){var i=new e,s=document.createElement("input");s.className="hidden",document.getElementsByTagName("body")[0].appendChild(s),openQuicksearch=new t({input:i.identify(s)}).openQuicksearchDetailDialog})}):setTimeout(arguments.callee,200)};waitForRequireJsAndInjectQuicksearchFunction()}var results_tfd_global={},tfd_object;MikaResultsTfd.prototype={result:[],prev_result:[],hash:"",hash_filters:"",config:"",options_submit:{},paused:!1,filter_fields:{},only_favorites:!1,requester:{},favorites:!1,ack_favorites:[],sound:!1,timer:{},clocks:{},ids_on_screen:[],init:function(){this.favorites||(this.favorites=[]);var t=document.cookie.match("results_favorites=(.*?)(;|$)");if(null!=t){t[1]=unescape(t[1]),favorites=t[1].split("|");for(i in favorites)favorites[i]&&jQuery.inArray(favorites[i],this.favorites)&&this.favorites.push(favorites[i])}void 0===this.filter_fields[this.options.obj]&&(this.filter_fields[this.options.obj]={}),this.options.localSettings=[],this.options.localSettings.push("paused"),this.options.localSettings.push("sound"),this.options.localSettings.push("only_favorites");var e=this.options.obj;this.options_submit={fields:{},options:{}},this.makeRequest("getTFDConfig",{lang:this.options.lang,pid:this.options.pid},function(t){window[e].setConfig(t),window[e].render(!1),jQuery.playSoundInit(t.sound)})},trackGA:function(t){"object"==typeof ga_track?ga_track.push(["_trackPageview","/"+t]):"undefined"!=typeof console&&this.options.debug&&console.info("Leaderboard: No GA")},setData:function(t){if("timeout"!=t.status){this.result=t,"update_filter"!=this.result.status&&(this.prev_result=this.result);for(var e in this.result.filters)for(var i in this.result.filters[e].values)if(this.result.filters[e].values[i].selected){this.options_submit.fields[this.result.filters[e].field]=this.result.filters[e].values[i].key,this.filter_fields[this.options.obj][this.result.filters[e].field]=this.result.filters[e].values[i].key;break}if("paused"==this.result.status)return this.render(!0),void window.setTimeout(this.options.obj+".load()",3e4);this.hash=this.result.hash,this.render(!0),this.reload()}else this.reload()},setConfig:function(t){this.config=t;var e=this.options.obj;this.config.shortcuts&&jQuery(document).keydown(function(t){"input"!=document.activeElement.nodeName.toLowerCase()&&"textarea"!=document.activeElement.nodeName.toLowerCase()&&("32"==t.keyCode&&window[e].switchPause(),"70"==t.keyCode&&window[e].switchFavorites(),"88"==t.keyCode&&window[e].switchFullscreen(),"65"==t.keyCode&&window[e].ackFavorites(),"84"==t.keyCode&&window[e].testSound())}),this.config.buttons_selected.favorites&&(this.only_favorites=!0),this.config.buttons_selected.sound&&(this.sound=!0),this.readConfig(),this.reload()},testSound:function(){if(this.config.sound.active&&this.sound){var t={};t.row=!0,t.update=!0,t.favorite=!0;for(i in t)void 0!==this.config.sound["url_"+i]&&this.config.sound["url_"+i]&&jQuery.playSound(i)}},readConfig:function(){if("undefined"!=typeof localStorage){for(var t in this.options.localSettings){null!=(o=localStorage.getItem("mikatfd_"+this.options.obj+"_config_"+this.options.localSettings[t]))&&("false"==o?o=!1:"true"==o&&(o=!0),this[this.options.localSettings[t]]=o)}var e=sessionStorage.getItem("mikatfd_"+this.options.obj+"_config_filters");if(e){var i=e.split(",");for(var s in i)if(i.hasOwnProperty(s)){null!=(o=sessionStorage.getItem("mikatfd_"+this.options.obj+"_config_field_"+i[s]))&&(this.options_submit.fields[i[s]]=o)}}null!=(o=sessionStorage.getItem("mikatfd_"+this.options.obj+"_config_field_lpc"))&&(this.options_submit.fields.lpc=o);var o;null!=(o=sessionStorage.getItem("mikatfd_"+this.options.obj+"_config_ack_favorites"))&&(this.ack_favorites=JSON.parse(o))}},saveConfig:function(){if("undefined"!=typeof localStorage){for(var t in this.options.localSettings)localStorage.setItem("mikatfd_"+this.options.obj+"_config_"+this.options.localSettings[t],this[this.options.localSettings[t]]);var e=[];for(var i in this.options_submit.fields)(this.options_submit.fields.hasOwnProperty(i)||this.options_submit.fields[i])&&(sessionStorage.setItem("mikatfd_"+this.options.obj+"_config_field_"+i,this.options_submit.fields[i]),e.push(i));sessionStorage.setItem("mikatfd_"+this.options.obj+"_config_filters",e.join(",")),this.options_submit.fields.lpc&&sessionStorage.setItem("mikatfd_"+this.options.obj+"_config_field_lpc",this.options_submit.fields.lpc),sessionStorage.setItem("mikatfd_"+this.options.obj+"_config_ack_favorites",JSON.stringify(this.ack_favorites))}},stop:function(){this.requester["getTFD"+this.options.obj].abort()},switchPause:function(){this.paused?(this.paused=!1,this.reload()):(this.requester["getTFD"+this.options.obj].abort(),this.paused=!0),this.saveConfig(),jQuery("#"+this.options.target+" #tfd-status-buttons").html(this.renderStatusButtons())},switchSound:function(){this.sound?this.sound=!1:this.sound=!0,this.saveConfig(),jQuery("#"+this.options.target+" #tfd-status-buttons").html(this.renderStatusButtons())},switchFavorites:function(){this.only_favorites?this.only_favorites=!1:this.only_favorites=!0,this.paused||(this.requester["getTFD"+this.options.obj].abort(),this.reload(!0)),this.saveConfig(),jQuery("#"+this.options.target+" #tfd-status-buttons").html(this.renderStatusButtons())},makeRequest:function(t,e,i){tfd_object=this.options.obj,this.requester[t+this.options.obj]=jQuery.ajax({type:"POST",url:"index.php?content=ajax2&func="+t,data:{func:t,options:e},success:i})},ackFavorites:function(){jQuery("#"+this.options.target+" .tfd-row.favorite").addClass("favorite-ack")},reloadAckFavoritesMark:function(){jQuery("#"+this.options.target).removeClass("favorite-ack");for(var t in this.ack_favorites)jQuery("#"+this.options.target+"  #id-"+this.ack_favorites[t]).addClass("favorite-ack")},ackSwitchFavorite:function(t){if(-1!=this.ack_favorites.indexOf(t)){var e=[];if(-1!=this.ack_favorites.indexOf(t)){for(i in this.ack_favorites)this.ack_favorites[i]!=t&&e.push(this.ack_favorites[i]);this.ack_favorites=e}jQuery("#"+this.options.target+"  #id-"+t).removeClass("favorite-ack")}else this.ack_favorites.push(t),jQuery("#"+this.options.target+"  #id-"+t).addClass("favorite-ack");this.saveConfig()},load:function(){},reload:function(t){"function"==typeof window.hookTfdReload&&window.hookTfdReload(),this.only_favorites?this.options_submit.only_favorites=1:this.options_submit.only_favorites&&(this.options_submit.only_favorites=0),this.options_submit.pid=this.options.pid,this.options_submit.hash=this.hash,this.options_submit.hash_filters=this.hash_filters,this.options_submit.event=this.options.event,t?this.options_submit.last_seq=0:"ok"==this.result.status&&void 0!==this.result.data[0]&&void 0!==this.result.data[0].seq?this.options_submit.last_seq=this.result.data[0].seq:"update_filter"!=this.result.status&&(this.options_submit.last_seq=0);var e=this.options.obj;this.makeRequest("getTFD",{options:this.options_submit},function(t){window[e].setData(t)})},setFilter:function(t,e,i){this.paused&&this.switchPause(),this.filter_fields[this.options.obj][t]!=e||i?this.filter_fields[this.options.obj][t]=e:delete this.filter_fields[this.options.obj][t],this.options_submit={fields:this.filter_fields[this.options.obj],options:{}},this.requester["getTFD"+this.options.obj].abort(),this.saveConfig(),this.reload(!0)},switchFullscreen:function(){"fixed"!=jQuery(".tfd-container").css("position")?(results_tfd_global.fullscreen_old_style={height:jQuery("#tfd-container #tfd-main").height()+"px",position:"relative",width:"auto"},jQuery(".tfd-container").css({position:"fixed",overflow:"hidden",zIndex:1090,top:0,left:0,width:jQuery(window).width()+"px",height:jQuery(window).height()+"px",backgroundColor:"#FFFFFF"}),jQuery("#tfd-container #tfd-content").height(jQuery(window).height()-56)):(jQuery(".tfd-container").css(results_tfd_global.fullscreen_old_style),jQuery("#tfd-content").height(jQuery("#tfd-container").height())),this.updateFilterStatus()},resetAllFilters:function(){var t=this;jQuery.each(this.filter_fields[this.options.obj],function(e){delete t.filter_fields[t.options.obj][e]}),this.options_submit={fields:this.filter_fields[this.options.obj],options:{}},this.requester["getTFD"+this.options.obj].abort(),this.saveConfig(),this.reload(!0)},renderStatusButtons:function(){var t="";return this.paused?t+='<a class="button-pause pause-on" onclick="'+this.options.obj+'.switchPause(); return false;" href="#">'+this.config.strings.pause+"</a>":t+='<a class="button-pause pause-off" onclick="'+this.options.obj+'.switchPause(); return false;" href="#">'+this.config.strings.pause+"</a>",t+='<a class="button-fullscreen" onclick="'+this.options.obj+'.switchFullscreen(); return false;" href="#">'+this.config.strings.fullscreen_toggle+"</a>",this.only_favorites?t+='<a class="button-favorites pause-on" onclick="'+this.options.obj+'.switchFavorites(); return false;" href="#">'+this.config.strings.only_favorites+"</a>":t+='<a class="button-favorites pause-off" onclick="'+this.options.obj+'.switchFavorites(); return false;" href="#">'+this.config.strings.only_favorites+"</a>",this.config.sound&&(this.sound?t+='<a class="button-favorites sound-on" onclick="'+this.options.obj+'.switchSound(); return false;" href="#">'+this.config.strings.sound+"</a>":t+='<a class="button-favorites pause-off" onclick="'+this.options.obj+'.switchSound(); return false;" href="#">'+this.config.strings.sound+"</a>"),t+='<a class="button-favorites filters-reset" onclick="'+this.options.obj+'.resetAllFilters(); return false;" href="#">'+this.config.strings.reset_all_filters+"</a>"},renderFilterStatus:function(){var t="";if(void 0!==this.result.filters){jQuery("#"+this.options.target+" #tfd-status-filters").addClass("num-filters-"+Object.keys(this.result.filters).length);var e=this.options.obj,i=0;jQuery.each(this.result.filters,function(s,o){if("status-bar"==o.type){t+='<div class="status-container field-'+o.field+" num-filter-"+i+'">',t+='<div class="legend">'+o.title+"</div>",t+='<div class="status field field-'+o.field+'">';var a=jQuery("#tfd-main .status.field-"+o.field).width();a||(a=jQuery("#tfd-main").width()),"fixed"==jQuery("#tfd-container").css("position")&&(a-=22);var r=o.values.length;o.num_button_rows&&(r=Math.ceil(o.values.length/o.num_button_rows));var n=a/r;n*=o.button_width_factor;var l='style="width:'+(n-=.2)+'px;" ',d="";jQuery.each(o.values,function(i,s){d="",s.has_data&&(d+=" active");var a="";s.fav_count&&(a='<span class="badge">'+s.fav_count+"</span>"),s.selected&&(d+=" selected"),i==o.values.length-1&&(d+=" last"),o.classes&&(d+=" "+o.classes);var r="";s.subtext&&(r="<span>"+s.subtext+"</span>"),t+="<a "+l+'onclick="'+e+".setFilter('"+o.field+"', '"+s.key+"', "+o.is_index+'); return false;" href="#" class="'+d+'">'+s.value+r+a+"</a>"}),t+="</div>",t+="</div>",i++}}),t+='<div style="clear:both;"></div>'}return t},updateFilterStatus:function(){jQuery("#"+this.options.target+" #tfd-status-filters").html(this.renderFilterStatus())},render:function(t){this.options_submit.last_seq||(this.ids_on_screen=[]);var e="",i="",s="",o=[],a=[],r=[];if(t||(e+='<div class="tfd-main" id="tfd-main">',e+='<div id="tfd-status" class="hideable-extended">',e+='<div id="tfd-status-buttons" class="status buttons"></div>',e+='<div id="tfd-status-filters"></div>',e+="</div>",e+='<div class="tfd-legend-row status"></div>',e+='<div class="tfd-content-wrap">',e+='<div id="tfd-content">'),void 0!==this.result.data)if("paused"==this.result.status)e+='<div class="tfd-row">',e+='<div class="tfd-pri">',e+='<div class="paused">Stream pausiert. Wird automatisch fortgesetzt.</div>',e+="</div>";else if(this.result.data.length||"ok"!=this.result.status){var n,l=!1,d=!1;this.options_submit.last_seq?this.result.data.length&&(jQuery("#"+this.options.target+" #tfd-content").removeClass("initial"),l=this.result.data.length):(void 0!==this.prev_result.data&&this.prev_result.data.length?(n=this.prev_result.data[0].seq,jQuery.each(this.result.data,function(t,e){if(e.seq==n)return l=t,!1})):n=!1,jQuery("#"+this.options.target+" #tfd-content").addClass("initial")),d=jQuery("#"+this.options.target+" .tfd-row").first().hasClass("highlight")?!(l%2):!!(l%2);var h=this.config,p=this.favorites,c=this.options_submit.last_seq,u=0,g={},f=this.ids_on_screen,m={},_=this.options.obj;jQuery.each(this.result.data,function(t,n){if(void 0===n.seq)return!0;var v="",y="",b=!1,k="",w="",j="",C="",M=!1;if(m.row=!0,h.update_on_duplicates){var x=!1;for(var S in f)if(f[S]==n.id){M=!0,m.update=!0;break}}if(-1!=jQuery.inArray(n.id,p)?(b=!0,v+=" favorite"):n.fav&&(v+=" favorite",m.favorite=!0),n.css_class&&(v+=" "+n.css_class),d?(v+=" highlight",d=!1):(d=!0,v+=""),(l||c)&&(t<l||c)&&!M&&(v+=" newentry"),M&&(v+=" updated"),n.index&&(v+=" index-"+n.index,r.push(n.index)),void 0!==n.g.marker&&n.g.marker.length&&(v+=" has-marker marker-"+n.g.marker.length),void 0!==n.g.secondary&&n.g.secondary.length&&(v+=" twoline"),void 0!==n.g.tertiary&&n.g.tertiary.length&&(v+=" threeline"),n.hi?y+=" background-color:"+n.hi+";":b&&(v+=" fav-color i-"+jQuery.inArray(n.id,p)),h.quicksearch&&(y+="cursor:pointer;",k=" onclick=\"openQuicksearch('"+n.id+"', '"+n.event_id+"', '');\""),n.fav&&(y+="cursor:pointer;",w=" onmouseover=\"jQuery(this).addClass('rowbuttons');\"",j=" onmouseout=\"jQuery(this).removeClass('rowbuttons');\"",C='<div class="rowbuttons-buttons"><a href="javascript:;" onclick="'+_+".ackSwitchFavorite('"+n.id+"');\">ACK</a></div>"),u++,i='<div id="id-'+n.id+'" style="'+y+'" class="tfd-row '+v+'"'+w+j+">",C&&(i+=C),void 0!==n.g.marker&&(i+='<div class="tfd-marker"'+k+">",jQuery.each(n.g.marker,function(t,e){i+='<div title="'+e.v+'" class="marker field-'+e.n.toLowerCase()+" value-"+(null!==e.v?e.v.replace(" ","").toLowerCase():"")+'">',e.v,"cutoff"==e.n&&void 0!==e.o&&void 0!==e.o.cutoff_discipline&&null!=e.o.cutoff_discipline&&(i+='<div class="discipline">'+e.o.cutoff_discipline+"</div>"),i+="</div>",void 0!==e.o&&(g[n.id]={field:e.n.toLowerCase(),options:e.o})}),i+="</div>"),void 0!==n.g.primary){i+='<div class="tfd-pri"'+k+">",jQuery.each(n.g.primary,function(t,e){if(void 0!==e.o&&void 0!==e.o.width)var s='style="width:'+e.o.width+'"';else s="";i+="<div "+s+' class="field '+e.n.toLowerCase()+'">',e.v&&(i+=e.v),i+="</div>",void 0!==e.o&&(g[n.id]={field:e.n.toLowerCase(),options:e.o})}),i+="</div>";var O="";void 0!==n.g.marker&&n.g.marker.length&&(O+=" has-marker marker-"+n.g.marker.length),s='<div class="tfd-pri tfd-pri-legend '+O+'">',jQuery.each(n.g.primary,function(t,e){if(void 0!==e.o&&void 0!==e.o.width)var i='style="width:'+e.o.width+'"';else i="";s+="<div "+i+' class="field '+e.n.toLowerCase()+'">',e.n&&(s+=e.n),s+="</div>"}),s+="</div>"}if(void 0!==n.g.secondary&&(i+='<div class="tfd-sec"'+k+">",jQuery.each(n.g.secondary,function(t,e){if(void 0!==e.o&&void 0!==e.o.width)var s='style="width:'+e.o.width+'"';else s="";i+="<div "+s+' class="field '+e.n.toLowerCase()+'">',i+='<div class="legend">'+e.n+"</div>",i+=e.v,i+="</div>",void 0!==e.o&&(g[n.id]={field:e.n.toLowerCase(),options:e.o})}),i+="</div>"),void 0!==n.g.tertiary&&(i+='<div class="tfd-tertiary"'+k+">",jQuery.each(n.g.tertiary,function(t,e){i+='<div class="field '+e.n.toLowerCase()+'">',i+='<div class="legend">'+e.n+"</div>",i+=e.v,i+="</div>",void 0!==e.o&&(g[n.id]={field:e.n.toLowerCase(),options:e.o})}),i+="</div>"),i+='<div style="clear:both"></div>',i+="</div>",h.update_on_duplicates){x=!1;for(var S in f)if(f[S]==n.id){a.push({id:n.id,content:i}),x=!0;break}x||(o.push(i),e+=i)}else o.push(i),e+=i;if(f.push(n.id),h.close_on_duplicates&&is_close)for(var S in f)f[S]==n.id&&delete f[S]})}else e+='<div class="tfd-row">',e+='<div class="tfd-pri">',e+='<div class="paused">'+this.config.strings.no_results+"</div>",e+="</div>";if(t||(e+="</div>",e+='<div class="tfd-content-shadow"></div>',e+="</div>",e+="</div>"),this.options_submit.last_seq){if(void 0!==h&&"overview"==h.mode)for(var v in r)if(jQuery("#"+this.options.target+" .index-"+r[v]).replaceWith(o[v]).length)jQuery("#"+this.options.target+" .index-"+r[v]).removeClass("newentry"),jQuery("#"+this.options.target+" .index-"+r[v]).addClass("updated");else{var y=[];if(jQuery("#"+this.options.target+" .tfd-row").each(function(t){var e=jQuery(this).attr("class"),i=e.substr(e.indexOf("index-")+6);i=i.replace(" updated",""),y.push(i)}),y.length){var b=y;b.push(r[v]),isNaN(b[0])?b.sort():b.sort(function(t,e){return t-e});for(var k in b)b[k]==r[v]&&((k=parseInt(k))>0?jQuery("#"+this.options.target+" .index-"+b[k-1]).after(o[v]):jQuery("#"+this.options.target+" .index-"+b[k+1]).before(o[v]),jQuery("#"+this.options.target+" .index-"+r[v]).addClass("updated"))}else jQuery("#"+this.options.target+" #tfd-content").append(o[v])}else if(jQuery("#"+this.options.target+" #tfd-content").prepend(o.join("")),jQuery("#"+this.options.target+" #tfd-content div.tfd-row").length>this.result.max_entries)for(v=0;v<u;v++)jQuery("#"+this.options.target+" #tfd-content .tfd-row:last").remove();if(this.config.sound.active&&this.sound)for(v in m)void 0!==this.config.sound["url_"+v]&&this.config.sound["url_"+v]&&jQuery.playSound(v)}else t?jQuery("#"+this.options.target+" #tfd-content").html(e):jQuery("#"+this.options.target).html(e);s&&jQuery("#"+this.options.target+" .tfd-legend-row").html(s);for(var w in g)for(var j in g[w].options)switch(j){case"start_clock":g[w].options[j]&&this.clockStartForId(w,g[w].field);break;case"stop_clock":g[w].options[j]&&this.clockStopForId(w,g[w].field);break;case"call_trigger":if(this.result.from_seq)var C=!1;else C=!0;this.callTrigger(g[w].options[j],w,{init:C});break;case"timer":if(this.result.from_seq)C="false";else C="true";g[w].options[j].call_trigger&&g[w].options[j].timeout&&(this.timer["timer_"+w]=window.setTimeout(this.options.obj+".callTrigger('"+g[w].options[j].call_trigger+"', '"+w+"', {init:"+C+"});",g[w].options[j].timeout))}for(v in a)jQuery("#"+this.options.target+" #id-"+a[v].id).replaceWith(a[v].content);if(this.config.animation_speed){switch(this.config.animation){case"customTrigger":break;default:jQuery("#"+this.options.target+" .newentry").slideDown(this.config.animation_speed),jQuery("#"+this.options.target+" .closed").hide()}if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.updated)var M=this.config.highlight_animations.updated;else M=this.config.highlight_animations.default;M.disabled||jQuery("#"+this.options.target+" .updated").css({display:"block"}).effect("highlight",{color:M.color},M.speed)}}jQuery("#"+this.options.target+" .newentry").removeClass("newentry"),jQuery("#"+this.options.target+" .updated").removeClass("updated"),t||jQuery("#"+this.options.target+" #tfd-status-buttons").html(this.renderStatusButtons());var x=!1;jQuery("#"+this.options.target+" .status-container").length||(x=!0),this.hash_filters!=this.result.filters_hash&&(this.updateFilterStatus(),this.hash_filters=this.result.filters_hash),x&&this.updateFilterStatus(),this.reloadAckFavoritesMark(),MikaResultsRenderTrigger()},callTrigger:function(t,e,i){switch(t){case"open":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.opened)var s=this.config.highlight_animations.opened;else s=this.config.highlight_animations.default;var o=this.options.obj;i.init||jQuery("#"+this.options.target+" #id-"+e).animate({width:"show"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).effect("highlight",{color:s.color,duration:s.speed})}})}break;case"update1":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.update1)s=this.config.highlight_animations.update1;else s=this.config.highlight_animations.default;o=this.options.obj;i.init||jQuery("#"+this.options.target+" #id-"+e).animate({width:"show"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).effect("highlight",{color:s.color,duration:s.speed})}})}break;case"update2":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.update2)s=this.config.highlight_animations.update2;else s=this.config.highlight_animations.default;o=this.options.obj;i.init||jQuery("#"+this.options.target+" #id-"+e).animate({width:"show"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).effect("highlight",{color:s.color,duration:s.speed})}})}break;case"update3":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.update3)s=this.config.highlight_animations.update3;else s=this.config.highlight_animations.default;o=this.options.obj;i.init||jQuery("#"+this.options.target+" #id-"+e).animate({width:"show"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).effect("highlight",{color:s.color,duration:s.speed})}})}break;case"close":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.closed)s=this.config.highlight_animations.closed;else s=this.config.highlight_animations.default;o=this.options.obj;i.init?jQuery("#"+this.options.target+" #id-"+e).remove():jQuery("#"+this.options.target+" #id-"+e).effect("highlight",{color:s.color,duration:s.speed,complete:function(){jQuery(this).animate({width:"hide"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).remove()}})}})}break;case"close_timeout":if(this.config.highlight_animations){if(void 0!==this.config.highlight_animations.closed_timeout)s=this.config.highlight_animations.closed_timeout;else s=this.config.highlight_animations.default;o=this.options.obj;i.init?jQuery("#"+this.options.target+" #id-"+e).remove():jQuery("#"+this.options.target+" #id-"+e).effect("highlight",{color:s.color,duration:s.speed,complete:function(){jQuery(this).animate({width:"hide"},{duration:window[o].config.animation_speed,complete:function(){jQuery(this).remove()}})}})}}},clockStartForId:function(t,e){this.clocks[t]={field:e,time:0},this.clockUpdate(t),void 0!==this.timer[t]&&window.clearInterval(this.timer[t]),this.timer[t]=window.setInterval(this.options.obj+".clockUpdate('"+t+"')",100)},clockStopForId:function(t){delete this.clocks[t],window.clearInterval(this.timer[t]),delete this.timer[t]},clockUpdate:function(t){if(void 0!==this.clocks[t]){var e=jQuery("#"+this.options.target+" #id-"+t+" .field."+this.clocks[t].field);if(e.length){this.clocks[t].time+=100;var i=this.parseSeconds(this.clocks[t].time,!0);i.hours<10&&(i.hours="0"+i.hours),i.minutes<10&&(i.minutes="0"+i.minutes),i.seconds<10&&(i.seconds="0"+i.seconds),i.milliseconds=i.milliseconds/10,0==i.milliseconds&&(i.milliseconds="00");var s="";s+=i.hours+":",s+=i.minutes+":",s+=i.seconds+".",s+=""+i.milliseconds/10,e.html(s)}else this.clockStopForId(t)}},clockClearTimers:function(){for(var t in this.clocks)window.clearInterval(this.timer[t]),delete this.timer[t];this.clocks=[]},setOptions:function(t){this.options=t},parseSeconds:function(t,e){var i={};e||(t*=1e3),i.days=Math.floor(t/864e5);var s=t%864e5;return i.hours=Math.floor(s/36e5),s%=36e5,i.minutes=Math.floor(s/6e4),s%=6e4,i.seconds=Math.floor(s/1e3),i.milliseconds=s%1e3,i}},MikaResultsSearch.prototype={jq:{},options:{},requester:{},data:{},targetElement:{},strings:{},timer:{},options_submit:{},branches:{},timer:{},setOptions:function(t){this.options=t},setJQ:function(t){this.jq=t},createSearchFields:function(t){if("function"!=typeof this.jq&&"function"==typeof jQuery)this.jq=jQuery.noConflict();else if("function"!=typeof this.jq)return void console.log("no jQuery found!");this.reload()},makeRequest:function(t,e,i){this.requester[t]=this.jq.ajax({type:"GET",url:"index.php",data:{content:"ajax2",func:t,options:e},success:i,complete:function(){res2.unlockForm()}})},load:function(){var t=new this.jq.Deferred;return this.options_submit.lang=this.options.lang,this.options_submit.pid=this.options.pid,this.makeRequest("getSearchFields",this.options_submit,function(e){res2.setData(e),t.resolve()}),t.promise()},reload:function(t,e,i,s){var o=new this.jq.Deferred;if(this.options_submit.b={},t&&"event_main_group"==t.attr("name"))for(var e in this.options.mapping)for(var a in this.options.mapping[e]){var r=this.options.mapping[e][a],n=this.jq(r.parent+" "+r.element);"event"!=r.field&&"event_main_group"!=r.field&&("%"!=n.val()&&""!=n.val()&&(n.is("select")?n.val("%"):n.val("")))}for(var l in this.options.mapping){this.options_submit.b[l]={};for(var a in this.options.mapping[l]){r=this.options.mapping[l][a];if(e==l||!i||i==r.parent){if("%"!=(n=this.jq(r.parent+" "+r.element)).val()&&""!=n.val()){if("event_main_group"==r.field&&t&&"event_main_group"==t.attr("name"))for(var d in this.options.mapping)for(var h in this.options.mapping[d]){var p=this.options.mapping[d][h];if("event_main_group"==p.field){var c=this.jq(p.parent+" "+p.element);c.find('option[value="'+s.value+'"]').length>0&&c.val(s.value)}}"event"==r.field&&t&&"event_main_group"==t.attr("name")?this.options_submit.b[l][r.field]="":this.options_submit.b[l][r.field]=n.val()}}}this.lockForm(l)}return this.load().then(function(){o.resolve()}),o.promise()},setData:function(t){this.branches=t.branches,this.strings=t.strings,this.render()},render:function(){for(var t in this.options.mapping)if(this.options.mapping.hasOwnProperty(t))for(var e in this.options.mapping[t])if(this.options.mapping[t].hasOwnProperty(e)){var i=this.options.mapping[t][e],s=this.jq(i.parent+" "+i.element),o=this.branches[t].fields[i.field];"ok"==o.state&&o.data.length?this.generateSelectFromField(s,o.data,s.val(),i,t):this.generateField(s,s.val()),1!=this.branches[t].fields[i.field].data.length||this.branches[t].fields[i.field].data[0].v[0]}},lockForm:function(t){for(var e in this.options.mapping)if(this.options.mapping.hasOwnProperty(e)){for(var i in this.options.mapping[e]){var s=this.options.mapping[e][i];this.jq(s.parent+" "+s.element).attr("disabled","disabled")}window.clearTimeout(res2.timer[t]),res2.timer[t]=window.setTimeout("res2.showIndicator('"+t+"')",400)}},showIndicator:function(t){jQuery(".branch-"+t+" .box-content");jQuery(".panel-loading").css("display","block")},unlockForm:function(){jQuery(".panel-loading").css("display","none");for(var t in res2.timer)window.clearTimeout(res2.timer[t])},generateSelectFromField:function(t,e,i,s,o){t.attr("placeholder")||t.attr("placeholder","");var a=this.jq("<select></select>");a.attr({placeholder:t.attr("placeholder"),class:t.attr("class"),name:t.attr("name"),id:t.attr("id")}),i||(i="%");for(var r in e){var n,l;"object"==typeof e[r].v?(n=e[r].v[0],l=1==e[r].n?e[r].v[1]:e[r].n&&null!=e[r].n?e[r].v[1]+" ("+e[r].n+")":e[r].v[1]):(n=e[r].v,l=1==e[r].n?e[r].v:e[r].n&&null!=e[r].n?e[r].v+" ("+e[r].n+")":e[r].v);var d=this.jq("<option>");d.html(l),i==n?d.attr({value:n,selected:"selected"}):d.attr({value:n}),a.append(d)}a.change(function(){res2.reload(t,o,s.parent,this)}),t.replaceWith(a)},generateField:function(t,e){t.attr("placeholder")||t.attr("placeholder","");var i=this.jq("<input>");i.attr({placeholder:t.attr("placeholder"),class:t.attr("class"),name:t.attr("name"),id:t.attr("id"),value:e}),i.change(function(){res2.reload()}),t.replaceWith(i)}},mouseX=0,mouseX=0,ResultsClientTools.prototype={id:"",fields:{},request:{},selected:{},path:"",labels:{},type:"",data:{},strings:{},syncProxy:{},init:function(){},setData:function(t){this.data=t,this.replaceElementsWithDistinctData(this.fields)},setImagePath:function(t){this.imagePath=t},setLanguage:function(t){this.language=t},setStrings:function(t){this.strings=t},render:function(){this.request&&("list"==this.type?this.syncProxy=new ResultsServer({getDistinctResults:function(t){rObj_list.setData(t)}}):this.syncProxy=new ResultsServer({getDistinctResults:function(t){rObj.setData(t)}}),this.syncProxy.getDistinctResults(this.fields,this.request,this.language,this.type))},replaceElementsWithDistinctData:function(t){var e=this.data;t.each(function(t,i){var s=!1;void 0!==t.disable_all&&(s=t.disable_all),"object"==typeof e.data[i]?this.generateSelectFromElement(t.element,e.data[i],this.selected[t.field],s):this.generateElementFromSelect(t.element,this.selected[t.field])},this)},generateSelectFromElement:function(t,e,i,s){$(t).placeholder||($(t).placeholder="");var o=new Element("select",{placeholder:$(t).placeholder,class:$(t).class,name:$(t).name,id:$(t).id});this.labels[$(t).id]=$(t).placeholder,"list"==this.type?o.observe("change",function(){rObj_list.reload(this.id)}):o.observe("change",function(){rObj.reload(this.id)});var a=!1;if(i&&e.each(function(t,e){"object"==typeof t.v?(option_key=t.v[0],1==t.n?option_value=t.v[1]:t.n&&null!=t.n?option_value=t.v[1]+" ("+t.n+")":option_value=t.v[1]):(option_key=t.v,1==t.n?option_value=t.v:t.n&&null!=t.n?option_value=t.v+" ("+t.n+")":option_value=t.v),i==option_key&&(a=!0)},this),$(t).name,s||(!a&&i&&"%"!=i?(o.insert(new Element("option",{value:"%"}).update(this.strings.all)),o.insert(new Element("option",{selected:"selected",value:escapeHtml(i)}).update(this.strings.all_containing+' "'+escapeHtml(i)+'"'+(e.length?" ...":"")))):o.insert({top:new Element("option",{value:"%"}).update(this.strings.all+(e.length?" ...":""))})),e.each(function(t,e){"object"==typeof t.v?(option_key=t.v[0],1==t.n?option_value=t.v[1]:t.n&&null!=t.n?option_value=t.v[1]+" ("+t.n+")":option_value=t.v[1]):(option_key=t.v,1==t.n?option_value=t.v:t.v&&null!=t.n?option_value=t.v+" ("+t.n+")":option_value=t.v),i==option_key?option=new Element("option",{value:option_key,selected:"selected"}).update(option_value):option=new Element("option",{value:option_key}).update(option_value),o.insert(option)},this),Element.replace(t,o),i&&"%"!=i)var r=new Element("img",{class:"clearButton",style:"display:inline",id:$(t).id+"clearButton",src:this.imagePath+"/icon_undo.gif",alt:this.strings.reset,title:this.strings.reset});else r=new Element("img",{class:"clearButton",style:"display:none",id:$(t).id+"clearButton",src:this.imagePath+"/icon_undo.gif",alt:this.strings.reset,title:this.strings.reset});"list"==this.type?r.observe("click",function(){rObj_list.clear($(t).id)}):r.observe("click",function(){rObj.clear($(t).id)}),void 0!=$($(t).id+"clearButton")?Element.replace($($(t).id+"clearButton"),r):o.insert({after:r})},generateElementFromSelect:function(t,e){"%"==e&&(e=""),$(t).placeholder||($(t).placeholder=this.labels[$(t).id]),"undefined"==$(t).placeholder&&($(t).placeholder="");var i=new Element("input",{type:"text",class:$(t).class,placeholder:$(t).placeholder,name:$(t).name,id:$(t).id,value:e});if("list"==this.type?i.observe("change",function(){rObj_list.reload(this.id)}):i.observe("change",function(){rObj.reload(this.id)}),Element.replace(t,i),e&&"%"!=e)var s=new Element("img",{class:"clearButton",style:"display:inline",id:$(t).id+"clearButton",src:this.imagePath+"/icon_undo.gif",alt:this.strings.reset,title:this.strings.reset});else s=new Element("img",{class:"clearButton",style:"display:none",id:$(t).id+"clearButton",src:this.imagePath+"/icon_undo.gif",alt:this.strings.reset,title:this.strings.reset});"list"==this.type?s.observe("click",function(){rObj_list.clear($(t).id)}):s.observe("click",function(){rObj.clear($(t).id)}),void 0!=$($(t).id+"clearButton")?Element.replace($($(t).id+"clearButton"),s):i.insert({after:s})},reload:function(t){this.selected={},this.fields.each(function(t){this.selected[t.field]=$(t.element).value,$(t.element).id,""!=$(t.element).value&&(this.request[t.field]=$(t.element).value)},this),this.render()},clear:function(t){this.fields.each(function(e){$(e.element).id==t&&(this.selected[e.field]="%",this.request[e.field]="%")},this),this.render()},setFields:function(t){this.fields=t},setType:function(t){this.type=t}};